<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flip Cards â€“ Sky Blue Freeze (Korean Adverbs)</title>
  <style>
    :root{
      --bg-1:#03121f; --bg-2:#0a1e2e;
      --ice-1:#ecfeff; --ice-2:#dbeafe; --ice-3:#bae6fd;
      --text:#eef6ff; --muted:#a9c3d9;
      --accent:#38bdf8; --accent-2:#0ea5e9;
      --cyan:#67e8f9; --cyan-2:#22d3ee; --navy:#0b2440;
      --ring:0 0 18px rgba(56,189,248,.55), 0 0 32px rgba(103,232,249,.35);
      --border:1px solid rgba(103,232,249,.30);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif; color:var(--text);
      min-height:100vh; display:flex; flex-direction:column; align-items:center; gap:12px;
      background:
        radial-gradient(1200px 800px at 5% -10%, rgba(56,189,248,.18), transparent 60%),
        radial-gradient(1200px 800px at 120% 110%, rgba(103,232,249,.16), transparent 60%),
        linear-gradient(180deg, var(--bg-1), #061a2b 65%, #04121e);
      position:relative; isolation:isolate; padding:22px 16px 42px;
    }
    body::before{
      content:""; position:fixed; inset:-20%;
      background: conic-gradient(from 200deg at 60% 40%, rgba(186,230,253,.12), rgba(34,211,238,.10), rgba(56,189,248,.14), rgba(186,230,253,.10), rgba(34,211,238,.10));
      filter:blur(48px); animation: drift 20s linear infinite; z-index:-1; opacity:.9;
    }
    @keyframes drift{0%{transform:translate3d(0,0,0) rotate(0) scale(1)}50%{transform:translate3d(-3%,1%,0) rotate(10deg) scale(1.05)}100%{transform:translate3d(0,0,0) rotate(0) scale(1)}}

    header{text-align:center}
    .title{
      margin:0; font-size:2.2rem; font-weight:900; letter-spacing:2px; text-transform:uppercase;
      background:linear-gradient(180deg, var(--ice-1), var(--ice-2) 55%, var(--ice-3));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      text-shadow:0 0 10px rgba(255,255,255,.75),0 0 24px rgba(56,189,248,.45);
    }
    .subtitle{ margin:4px 0 0; color:var(--muted); font-weight:600 }
    .progress{ margin-top:6px; font-weight:800; color:var(--ice-2) }

    .stage{ width:min(520px, 94vw); height:400px; display:flex; align-items:center; justify-content:center; margin-top:10px; }
    .flip{ perspective:1200px; width:100%; height:100%; }
    .card{ position:relative; width:100%; height:100%; transform-style:preserve-3d; transition: transform .75s cubic-bezier(.2,.7,.2,1); }
    .flipped .card{ transform:rotateY(180deg); }

    .face{ position:absolute; inset:0; border-radius:18px; backface-visibility:hidden; overflow:hidden; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px; text-align:center; padding:18px; }
    .front{ color:#0c253a; background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.88)); border:1px solid rgba(255,255,255,.65); box-shadow:0 12px 26px rgba(2,12,22,.45); }
    .back{ transform:rotateY(180deg); background: linear-gradient(180deg, rgba(10,30,46,.86), rgba(7,22,36,.94)); border:var(--border); box-shadow:var(--ring); }

    .ko{ font-size:2.6rem; font-weight:900; letter-spacing:.5px; text-shadow:0 1px 0 rgba(255,255,255,.7); color:#0c253a }
    .ko-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; width:min(460px,96%); }
    .play-base{ appearance:none; border:none; cursor:pointer; border-radius:10px; padding:10px 14px; font-weight:900; color:#072235; background:linear-gradient(90deg, var(--cyan), var(--accent)); box-shadow:0 6px 18px rgba(56,189,248,.35); }
    .play-base:hover{ filter:brightness(1.08) }

    .enhead{ font-size:1.1rem; font-weight:900; color:var(--ice-1); margin-top:6px; text-align:left; width:min(460px,96%); }

    /* bigger + centered adverb on the back */
    .ko-big{
      font-size:2rem; line-height:1.15; text-align:center; width:100%;
      margin:2px 0 4px; font-weight:900; letter-spacing:.5px; color:var(--ice-1);
    }
    @media (max-width:420px){ .ko-big{ font-size:1.8rem; } }

    .enlines{ width:min(460px,96%); margin:6px auto 0; padding:0; list-style:none; text-align:left; }
    .enlines li{ padding:8px 10px; margin:6px 0; border-radius:12px; background:linear-gradient(180deg, #071c2c, #061725); border:1px solid rgba(186,230,253,.2); color:var(--ice-2) }
    .enlines b{ color:var(--ice-3) }

    .sentence{ width:min(460px,96%); margin-top:6px; padding:10px 12px; border-radius:12px; background:linear-gradient(180deg, #071c2c, #061725); border:1px solid rgba(186,230,253,.2); color:var(--ice-1); font-size:1.15rem; }
    .gloss{ width:min(460px,96%); margin-top:6px; display:flex; flex-wrap:wrap; gap:8px; }
    .gchunk{ background:linear-gradient(180deg,#0b2438,#081c2d); border:1px solid rgba(186,230,253,.2); border-radius:10px; padding:6px 8px; }
    .gko{ display:block; font-weight:800; color:var(--ice-1); }
    .gen{ display:block; font-size:.92rem; color:var(--ice-3); opacity:.95 }

    .controls{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:0 }
    .btn{ appearance:none; border:none; cursor:pointer; font-weight:900; letter-spacing:.3px; border-radius:12px; padding:10px 14px; color:#072235; background:linear-gradient(90deg, var(--cyan), var(--accent)); box-shadow:0 6px 18px rgba(56,189,248,.35); transition:transform .12s ease, filter .2s ease, box-shadow .2s ease }
    .btn:hover{ filter:brightness(1.08); transform:translateY(-1px); box-shadow:var(--ring) }
    .ghost{ background:transparent; color:var(--ice-2); border:1px solid rgba(186,230,253,.35) }

    .gate, .finish{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(1,7,13,.55); backdrop-filter: blur(6px) saturate(130%); -webkit-backdrop-filter: blur(6px) saturate(130%); z-index:5; }
    .panel{ width:min(520px,92vw); background: linear-gradient(180deg, rgba(10,30,46,.86), rgba(7,22,36,.94)); border:var(--border); border-radius:16px; padding:20px; text-align:center; box-shadow:var(--ring); }
    .panel h2{ margin:0 0 8px; font-size:22px; font-weight:900; color:var(--ice-1) }
    .panel p{ margin:6px 0 14px; color:var(--muted) }

    @media (max-width:768px){ .stage{ height:420px } .ko{ font-size:2.8rem } }

    .flip.animating{ pointer-events:none; }
    @keyframes flyOut{ from{opacity:1; transform:translate3d(0,0,0) scale(1)} to{opacity:0; transform:translate3d(60vw,-6vh,0) rotate(8deg) scale(.96)} }
    @keyframes flyIn{ from{opacity:0; transform:translate3d(-60vw,6vh,0) rotate(-6deg) scale(.96)} to{opacity:1; transform:translate3d(0,0,0) rotate(0) scale(1)} }
    .flip.fly-exit .card{ animation: flyOut .55s cubic-bezier(.2,.7,.2,1) forwards; }
    .flip.fly-enter .card{ animation: flyIn .55s cubic-bezier(.2,.7,.2,1) forwards; }

    #flipToFront{
      background: linear-gradient(90deg, #a78bfa, #60a5fa) !important; color:#07162a !important; border:none !important;
      font-weight:900; letter-spacing:.6px; text-transform:uppercase;
      box-shadow:0 10px 26px rgba(96,165,250,.45), 0 0 26px rgba(167,139,250,.35);
    }
    #flipToFront:hover{ filter:brightness(1.08); box-shadow:0 0 22px rgba(96,165,250,.65), 0 0 34px rgba(167,139,250,.45); }

    /* 3D icy flip button (front) */
    #flipToBack{
      position:relative; padding:14px 22px !important; border-radius:16px;
      border:1px solid rgba(255,255,255,.75) !important; border-bottom-color:rgba(10,60,90,.45) !important; border-right-color:rgba(10,60,90,.35) !important;
      background:linear-gradient(180deg, rgba(236,254,255,.98) 0%, rgba(219,234,254,.96) 38%, rgba(56,189,248,.93) 100%) !important;
      color:#062136 !important; text-transform:uppercase; letter-spacing:.8px; font-weight:900;
      box-shadow:0 14px 28px rgba(56,189,248,.35), 0 6px 0 rgba(6,26,43,.65), inset 0 1px 0 rgba(255,255,255,.95), inset 0 -8px 20px rgba(7,34,53,.25);
      transform:translateY(-1px); transition:transform .18s ease, box-shadow .22s ease, filter .22s ease; overflow:hidden; isolation:isolate;
    }
    #flipToBack::before{ content:""; position:absolute; inset:2px 2px 10px 2px; border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,0) 60%); pointer-events:none; mix-blend-mode:screen; }
    #flipToBack::after{
      content:""; position:absolute; inset:-45% -70%;
      background:
        radial-gradient(12px 12px at 22% 32%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(10px 10px at 72% 65%, rgba(255,255,255,.55), transparent 60%),
        linear-gradient(115deg, rgba(255,255,255,0) 35%, rgba(255,255,255,.45) 50%, rgba(255,255,255,0) 65%);
      transform:translateX(-120%) rotate(8deg); animation:icySweep 2.6s ease-in-out infinite; pointer-events:none; mix-blend-mode:screen;
    }
    #flipToBack:hover{ filter:brightness(1.06); transform:translateY(-3px);
      box-shadow:0 18px 36px rgba(56,189,248,.45), 0 8px 0 rgba(6,26,43,.6), inset 0 1px 0 rgba(255,255,255,1), inset 0 -10px 24px rgba(7,34,53,.28); }
    #flipToBack:active{ transform:translateY(0); box-shadow:0 8px 16px rgba(56,189,248,.35), 0 3px 0 rgba(6,26,43,.7),
      inset 0 1px 0 rgba(255,255,255,.95), inset 0 -6px 16px rgba(7,34,53,.28); }
    @keyframes icySweep{ 0%{transform:translateX(-120%) rotate(8deg); opacity:.95} 50%{opacity:1} 100%{transform:translateX(120%) rotate(8deg); opacity:.95} }

    .koform{ font-size:1.24rem; font-weight:400; letter-spacing:.3px; color:var(--ice-1); }
    @media (max-width:420px){ .koform{ font-size:1.1rem; } }

    .floating-home {
      position: fixed; top: 0; right: 0;
      background: linear-gradient(90deg, var(--cyan), var(--accent));
      color: #072235; font-size: 14px; font-weight: 700; text-decoration: none;
      padding: 8px 16px; border-radius: 0 0 0 10px; box-shadow: 0 6px 18px rgba(56,189,248,.35);
      z-index: 9999; transition: all 0.25s ease; backdrop-filter: blur(8px) saturate(140%); -webkit-backdrop-filter: blur(8px) saturate(140%);
    }
    .floating-home:hover{ filter:brightness(1.12); box-shadow: 0 0 12px rgba(56,189,248,.55), 0 0 24px rgba(103,232,249,.45); transform: translateY(-1px); }

    /* ===== Choices (4 boxes) ===== */
    .quiz{ width:min(520px,94vw); margin:4px auto 0; }
    .quiz .toggleRow{
      display:flex; align-items:center; justify-content:center; gap:10px; color:var(--ice-2); margin:4px 0 6px;
    }
    .choicesGrid{
      display:grid; grid-template-columns:repeat(2, minmax(140px,1fr)); gap:10px;
      width:min(460px,96%); margin:6px auto 0;
    }
    .choiceBtn{
      appearance:none; border:1px solid rgba(186,230,253,.35); background:linear-gradient(180deg,#071c2c,#061725);
      color:var(--ice-1); font-weight:800; padding:10px 12px; border-radius:12px; cursor:pointer; text-align:center;
      min-height:44px; box-shadow:0 6px 18px rgba(56,189,248,.20); transition:filter .18s ease, transform .12s ease, box-shadow .18s ease;
      user-select:none; font-size:.92rem;
    }
    .choiceBtn:hover{ filter:brightness(1.08); transform:translateY(-1px) }
    .choiceBtn.correct{
      border-color:rgba(56,189,248,.8);
      box-shadow:0 0 0 2px rgba(56,189,248,.55), 0 0 22px rgba(56,189,248,.45);
      background:linear-gradient(180deg,#0b2a42,#08314e);
    }
    .choiceBtn.reveal{
      border-color:rgba(56,189,248,.9);
      box-shadow:0 0 0 3px rgba(56,189,248,.8), 0 0 28px rgba(56,189,248,.6);
      background:linear-gradient(180deg,#0b2a42,#08314e);
    }
    @keyframes shakeX{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-7px)} 40%{transform:translateX(7px)}
      60%{transform:translateX(-5px)} 80%{transform:translateX(5px)}
    }
    .choiceBtn.wrong{
      background:linear-gradient(180deg,#2b0a0a,#1a0707); border-color:rgba(255,99,132,.65);
      animation:shakeX .35s ease;
    }
  </style>
</head>
<body>
  <a href="index.html" class="floating-home">Home</a>

  <header>
    <h1 class="title">VIZKOR Flip Cards</h1>
    <p class="subtitle">Korean Adverbs (80)</p>
    <div class="progress" id="progress">&nbsp;</div>
  </header>

  <section class="stage">
    <div class="flip" id="flipWrap" aria-live="polite">
      <div class="card" id="card" tabindex="0" aria-label="Flip card">
        <section class="face front" id="front"></section>
        <section class="face back" id="back"></section>
      </div>
    </div>
  </section>



  <!-- ===== Choices UI (toggle + 4 boxes) ===== -->
  <section class="quiz" id="quiz">
    <div class="toggleRow">
      <input type="checkbox" id="toggleChoices" checked />
      <label for="toggleChoices">Show choices (English meaning)</label>
    </div>
    <div id="choicesGrid" class="choicesGrid" role="group" aria-label="Choices"></div>
  </section>

  <div class="gate" id="gate">
    <div class="panel">
      <h2>Start Practice</h2>
      <p>Enable audio first. Each new card autoplays the base Korean once. Flip to reveal meaning and an example sentence.</p>
      <div class="controls"><button class="btn" id="startBtn">Start (Enable Audio)</button></div>
    </div>
  </div>

  <div class="finish" id="finish" style="display:none">
    <div class="panel">
      <h2>Finished! ğŸ‰</h2>
      <p>Na-randomize na lahat. Gusto mo bang ulitin (reshuffle)?</p>
      <div class="controls"><button class="btn" id="restartBtn">Restart (Shuffle)</button></div>
    </div>
  </div>

  <audio id="koAudio" preload="auto"></audio>

  <script>
  // ===== DATA (Adverbs) =====
  const WORDS_MASTER = [
    // Core
    { ko:'ë¹¨ë¦¬', en:'quickly', tl:'mabilis' }, { ko:'ìì£¼', en:'often', tl:'madalas' },
    { ko:'ê°€ë”', en:'sometimes', tl:'minsan' }, { ko:'ì§€ê¸ˆ', en:'now', tl:'ngayon' },
    { ko:'ì•„ì§', en:'still / not yet', tl:'hindi pa' }, { ko:'ë²Œì¨', en:'already', tl:'tapos na' },
    { ko:'ë‹¤ì‹œ', en:'again', tl:'ulit' }, { ko:'ë§ì´', en:'a lot', tl:'marami' },
    { ko:'ì˜', en:'well', tl:'maayos / mabuti' }, { ko:'ì²œì²œíˆ', en:'slowly', tl:'dahan-dahan' },
    { ko:'í•­ìƒ', en:'always', tl:'palagi' }, { ko:'ë¨¼ì €', en:'first', tl:'una' },
    { ko:'ì œì¼', en:'the most', tl:'pinaka' }, { ko:'ì•„ì£¼', en:'very', tl:'napaka' },
    { ko:'ë„ˆë¬´', en:'too much / very', tl:'masyado' }, { ko:'ê¼­', en:'surely', tl:'tiyak' },
    { ko:'ì •ë§', en:'really', tl:'talaga' }, { ko:'ì¡°ê¸ˆ', en:'a little', tl:'kaunti' },
    { ko:'ì¢€', en:'a bit', tl:'medyo' },

    // Secondary
    { ko:'ê°™ì´', en:'together', tl:'kasama' }, { ko:'ê³§', en:'soon', tl:'malapit na' },
    { ko:'ë‚˜ì¤‘ì—', en:'later', tl:'mamaya' }, { ko:'ì•„ê¹Œ', en:'earlier', tl:'kanina' },
    { ko:'ë¯¸ë¦¬', en:'in advance', tl:'maaga' }, { ko:'íŠ¹íˆ', en:'especially', tl:'lalo na' },
    { ko:'ìš°ì„ ', en:'first of all', tl:'una sa lahat' }, { ko:'ëª¨ë‘', en:'all', tl:'lahat' },
    { ko:'ë³´í†µ', en:'usually', tl:'karaniwan' }, { ko:'ë³„ë¡œ', en:'not really (w/ ì•ˆ)', tl:'hindi naman' },
    { ko:'ì„œë¡œ', en:'each other', tl:'isaâ€™t isa' }, { ko:'ì–¸ì œë‚˜', en:'always', tl:'palagi' },
    { ko:'ì˜¤ë˜', en:'long (time)', tl:'matagal' }, { ko:'ë©€ë¦¬', en:'far', tl:'malayo' },
    { ko:'ì¡°ìš©íˆ', en:'quietly', tl:'tahimik' }, { ko:'ìê¾¸', en:'repeatedly', tl:'paulit-ulit' },
    { ko:'ì œëŒ€ë¡œ', en:'properly', tl:'nang maayos' }, { ko:'ì ì ', en:'gradually', tl:'unti-unti' },
    { ko:'ì§ì ‘', en:'directly', tl:'direkta' }, { ko:'ë˜', en:'also', tl:'din' },
    { ko:'ì£¼ë¡œ', en:'mainly', tl:'pangunahin' }, { ko:'ì¯¤', en:'about / around', tl:'humigit-kumulang' },

    // Extended
    { ko:'ê°‘ìê¸°', en:'suddenly', tl:'bigla' }, { ko:'ë”°ë¡œ', en:'separately', tl:'hiwalay' },
    { ko:'ê·¸ëƒ¥', en:'just', tl:'basta' }, { ko:'ê·¸ë™ì•ˆ', en:'in the meantime', tl:'samantala' },
    { ko:'ê·¸ë˜ë„', en:'still / even though', tl:'gayonpaman' }, { ko:'ëœ', en:'less', tl:'mas kaunti' },
    { ko:'ë¹ ì§ì—†ì´', en:'without exception', tl:'walang labis / kulang' }, { ko:'ì •í™•íˆ', en:'accurately', tl:'tumpak' },
    { ko:'í˜¼ì', en:'alone', tl:'mag-isa' }, { ko:'í•¨ë¶€ë¡œ', en:'carelessly', tl:'pabaya' },
    { ko:'ê³§ì¥', en:'straight / directly', tl:'diretso agad' }, { ko:'ê¸‰íˆ', en:'hastily', tl:'dali-dali' },
    { ko:'ë‚ ë§ˆë‹¤', en:'every day', tl:'araw-araw' }, { ko:'ëŒ€ì²´ë¡œ', en:'generally', tl:'sa pangkalahatan' },
    { ko:'ë‹¹ì¥', en:'immediately', tl:'mismong ngayon' }, { ko:'ë§‰', en:'just / randomly', tl:'basta na lang' },
    { ko:'ë°˜ë“œì‹œ', en:'absolutely', tl:'talagang / tiyak' }, { ko:'ì‚´ì§', en:'slightly', tl:'bahagya' },
    { ko:'ì•„ë§ˆ', en:'probably', tl:'marahil' }, { ko:'ì—­ì‹œ', en:'as expected', tl:'gaya ng inaasahan' },
    { ko:'ì¢…ì¢…', en:'occasionally', tl:'paminsan-minsan' }, { ko:'ì¤„ê³§', en:'continuously', tl:'tuloy-tuloy' },
    { ko:'ì°¨ë¡€ë¡œ', en:'in order', tl:'ayon sa pagkakasunod' }, { ko:'ì¶©ë¶„íˆ', en:'sufficiently', tl:'sapat' },
    { ko:'ìµœê·¼', en:'recently', tl:'kamakailan' }, { ko:'ìµœì†Œí•œ', en:'at least', tl:'kahit papaano' },
    { ko:'ìµœëŒ€í•œ', en:'as much as possible', tl:'pinaka kaya' }, { ko:'í”íˆ', en:'often / commonly', tl:'madalas' },
    { ko:'í˜¹ì‹œ', en:'perhaps', tl:'baka' }, { ko:'í˜„ì¬', en:'currently', tl:'kasalukuyan' },
    { ko:'í™•ì‹¤íˆ', en:'surely', tl:'tiyak' }, { ko:'í›¨ì”¬', en:'much (more)', tl:'mas higit' },
    { ko:'ëª¨ë‘ë“¤', en:'all (people)', tl:'lahat sila' }, { ko:'ëª°ë˜', en:'secretly', tl:'palihim' },
    { ko:'ë¬´ì¡°ê±´', en:'unconditionally', tl:'walang kondisyon' }, { ko:'ì„œë¡œì„œë¡œ', en:'with each other', tl:'isaâ€™t isa' },
    { ko:'ìŠ¬ìŠ¬', en:'slowly / gently', tl:'dahan-dahan lang' }, { ko:'ì–µì§€ë¡œ', en:'forcibly', tl:'pilit' },
    { ko:'í˜¹ì€', en:'or', tl:'o / kaya' },
  ];

  // ===== STATE =====
  let queue = [];
  let current = null;
  let index = 0;
  let audioReady = false;

  const gate = document.getElementById('gate');
  const finish = document.getElementById('finish');
  const progressEl = document.getElementById('progress');
  const flipWrap = document.getElementById('flipWrap');
  const cardEl = document.getElementById('card');
  const front = document.getElementById('front');
  const back  = document.getElementById('back');
  const player = document.getElementById('koAudio');
  let isAnimating = false;

  // Choices elements
  const choicesGrid = document.getElementById('choicesGrid');
  const toggleChoices = document.getElementById('toggleChoices');

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
  function updateProgress(){ progressEl.textContent = `${Math.min(index+1, WORDS_MASTER.length)} / ${WORDS_MASTER.length}`; }

  // ===== AUDIO =====
  const VOICERSS_KEY = "YOUR_VOICERSS_KEY_HERE";
  const audioCache = new Map();
  const koTtsUrl = (text)=>`https://api.voicerss.org/?key=${VOICERSS_KEY}&hl=ko-kr&c=MP3&f=48khz_16bit_mono&src=${encodeURIComponent(text)}`;
  function speakWeb(text){
    if(!('speechSynthesis' in window)) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'ko-KR'; u.rate = 0.95;
    try{ speechSynthesis.cancel(); }catch(e){}
    speechSynthesis.speak(u);
  }
  async function playKo(text){
    if(!audioReady) return;
    if(!VOICERSS_KEY || VOICERSS_KEY === "YOUR_VOICERSS_KEY_HERE"){ speakWeb(text); return; }
    let url = audioCache.get(text);
    if(!url){ url = koTtsUrl(text); audioCache.set(text, url); }
    player.src = url;
    try{ await player.play(); }catch(e){ speakWeb(text); }
  }

  // ===== RANDOM SENTENCE GENERATOR =====
  const subjects = ['ì €ëŠ”','ìš°ë¦¬ëŠ”','ì¹œêµ¬ëŠ”','ì•„ì´ë“¤ì€','ì„ ìƒë‹˜ì€','ê·¸ëŠ”','ê·¸ë…€ëŠ”','ì‚¬ëŒë“¤ì€','ë¹„ê°€','ê³ ì–‘ì´ëŠ”','ê°•ì•„ì§€ëŠ”'];
  const intransVerbs = ['ê°€ìš”','ì™€ìš”','ì¼í•´ìš”','ìš´ë™í•´ìš”','ì‰¬ì–´ìš”','ììš”','ê³µë¶€í•´ìš”','ì‚°ì±…í•´ìš”','ì›ƒì–´ìš”','ìš¸ì–´ìš”','ì—°ë½í•´ìš”','ì „í™”í•´ìš”','ì¶œë°œí•´ìš”','ë„ì°©í•´ìš”','ë§ì•„ìš”','ì§„í–‰í•´ìš”','ì‹œì‘í•´ìš”','ëë‚˜ìš”','ëª¨ì—¬ìš”','ë§Œë‚˜ìš”','ë– ë‚˜ìš”','ë‚˜ê°€ìš”'];
  const transVerbs = [
    {v:'ë¨¹ì–´ìš”', obj:true},{v:'ë§ˆì…”ìš”', obj:true},{v:'ì½ì–´ìš”', obj:true},{v:'ë°°ì›Œìš”', obj:true},
    {v:'ê¸°ë‹¤ë ¤ìš”', obj:true},{v:'ë§Œë“¤ì–´ìš”', obj:true},{v:'ë´ìš”', obj:true},{v:'ì²­ì†Œí•´ìš”', obj:true},
    {v:'ì¤€ë¹„í•´ìš”', obj:true},{v:'ë„ì™€ìš”', obj:true},{v:'ì‚¬ìš”', obj:true},{v:'íŒ”ì•„ìš”', obj:true},
    {v:'ì¢‹ì•„í•´ìš”', obj:true},{v:'ê³„ì‚°í•´ìš”', obj:true},{v:'ì°¸ì„í•´ìš”', obj:false},{v:'ê¸°ì–µí•´ìš”', obj:true},
    {v:'í™•ì¸í•´ìš”', obj:false},{v:'ì—´ì–´ìš”', obj:false},{v:'ì‘ì›í•´ìš”', obj:false},{v:'ì‹œë„í•´ìš”', obj:false}
  ];
  const objectsPool = ['ë°¥ì„','ë¹µì„','ë¬¼ì„','ì»¤í”¼ë¥¼','ì±…ì„','ì˜í™”ë¥¼','í•œêµ­ì–´ë¥¼','ìˆ™ì œë¥¼','ë°©ì„','ì§‘ì„','ì—°ìŠµì„','ë¬¸ì œë¥¼','ì¹œêµ¬ë¥¼','ì‹œê°„ì„'];
  const timeNouns = ['ì„¸ ì‹œ','ë„¤ ì‹œ','ë‚´ì¼','ì£¼ë§','ë‹¤ìŒ ì£¼','ì´ë²ˆ ì£¼','ì´ë²ˆ ë‹¬','ì˜¬í•´'];

  const specials = {
    'ë³„ë¡œ': ['ë³„ë¡œ ì•ˆ ë¨¹ì–´ìš”.','ë³„ë¡œ ì•ˆ ë°”ë¹ ìš”.','ë³„ë¡œ ì•ˆ ë¹„ì‹¸ìš”.'],
    'ì•„ì§': ['ì•„ì§ ì•ˆ ê°€ìš”.','ì•„ì§ ì•ˆ ëë‚¬ì–´ìš”.','ì•„ì§ ëª» í–ˆì–´ìš”.'],
    'ë²Œì¨': ['ë²Œì¨ ì‹œì‘í•´ìš”.','ë²Œì¨ ì™”ì–´ìš”.','ë²Œì¨ ëë‚¬ì–´ìš”.'],
    'ë‹¤ì‹œ': ['ë‹¤ì‹œ ì‹œì‘í•´ìš”.','ë‹¤ì‹œ ë°°ì›Œìš”.','ë‹¤ì‹œ ì‹œë„í•´ìš”.'],
    'ë§ì´': ['ë§ì´ ê³µë¶€í•´ìš”.','ë§ì´ ë¨¹ì–´ìš”.','ë§ì´ ì›ƒì–´ìš”.'],
    'ì˜': ['ì˜ ì§€ë‚´ìš”.','ì˜ ë“¤ì–´ìš”.','ì˜ ì•Œì•„ìš”.'],
    'ì²œì²œíˆ': ['ì²œì²œíˆ ê°€ìš”.','ì²œì²œíˆ ì½ì–´ìš”.','ì²œì²œíˆ ë§í•´ìš”.'],
    'í•­ìƒ': ['í•­ìƒ ë…¸ë ¥í•´ìš”.','í•­ìƒ ì¼ì° ììš”.','í•­ìƒ ê°ì‚¬í•´ìš”.'],
    'ë¨¼ì €': ['ë¨¼ì € ì‹œì‘í•´ìš”.','ë¨¼ì € ë“¤ì–´ê°€ìš”.','ë¨¼ì € ì¤€ë¹„í•´ìš”.'],
    'ì œì¼': ['í•œêµ­ì–´ë¥¼ ì œì¼ ì¢‹ì•„í•´ìš”.','ì œì¼ ë§›ìˆì–´ìš”.','ì œì¼ ë¹¨ë¼ìš”.'],
    'ì•„ì£¼': ['ì•„ì£¼ ì¢‹ì•„ìš”.','ì•„ì£¼ ì‰¬ì›Œìš”.','ì•„ì£¼ ë©€ì–´ìš”.'],
    'ë„ˆë¬´': ['ë„ˆë¬´ í”¼ê³¤í•´ìš”.','ë„ˆë¬´ ë§¤ì›Œìš”.','ë„ˆë¬´ ë¹¨ë¼ìš”.'],
    'ê¼­': ['ê¼­ ì™€ìš”.','ê¼­ ì—°ë½í•´ìš”.','ê¼­ ê¸°ì–µí•´ìš”.'],
    'ì •ë§': ['ì •ë§ ê³ ë§ˆì›Œìš”.','ì •ë§ ì˜ˆë»ìš”.','ì •ë§ ë§›ìˆì–´ìš”.'],
    'ì¡°ê¸ˆ': ['ì¡°ê¸ˆ ì‰¬ì–´ìš”.','ì¡°ê¸ˆë§Œ ë¨¹ì–´ìš”.','ì¡°ê¸ˆ ëŠ¦ì–´ìš”.'],
    'ì¢€': ['ì¢€ ë„ì™€ìš”.','ì¢€ ê¸°ë‹¤ë ¤ìš”.','ì¢€ ì²œì²œíˆ ë§í•´ìš”.'],
    'ê°™ì´': ['ê°™ì´ ê°€ìš”.','ê°™ì´ ë¨¹ì–´ìš”.','ê°™ì´ ê³µë¶€í•´ìš”.'],
    'ê³§': ['ê³§ ì‹œì‘í•´ìš”.','ê³§ ë„ì°©í•´ìš”.','ê³§ ëë‚˜ìš”.'],
    'ë‚˜ì¤‘ì—': ['ë‚˜ì¤‘ì— ë§Œë‚˜ìš”.','ë‚˜ì¤‘ì— í•´ìš”.','ë‚˜ì¤‘ì— ì „í™”í•´ìš”.'],
    'ì•„ê¹Œ': ['ì•„ê¹Œ ì „í™”í–ˆì–´ìš”.','ì•„ê¹Œ ë´¤ì–´ìš”.','ì•„ê¹Œ ë¨¹ì—ˆì–´ìš”.'],
    'ë¯¸ë¦¬': ['ë¯¸ë¦¬ ì¤€ë¹„í•´ìš”.','ë¯¸ë¦¬ ì˜ˆì•½í•´ìš”.','ë¯¸ë¦¬ í™•ì¸í•´ìš”.'],
    'íŠ¹íˆ': ['íŠ¹íˆ í•œêµ­ì–´ë¥¼ ì¢‹ì•„í•´ìš”.','íŠ¹íˆ ë§¤ìš´ ìŒì‹ì„ ì¢‹ì•„í•´ìš”.','íŠ¹íˆ ì£¼ë§ì— ë°”ë¹ ìš”.'],
    'ìš°ì„ ': ['ìš°ì„  ì •ë¦¬í•´ìš”.','ìš°ì„  í™•ì¸í•´ìš”.','ìš°ì„  ì‰¬ì–´ìš”.'],
    'ëª¨ë‘': ['ëª¨ë‘ ëª¨ì—¬ìš”.','ëª¨ë‘ ì™”ì–´ìš”.','ëª¨ë‘ ì´í•´í•´ìš”.'],
    'ë³´í†µ': ['ë³´í†µ ì¼ì° ììš”.','ë³´í†µ ì§‘ì—ì„œ ê³µë¶€í•´ìš”.','ë³´í†µ ë²„ìŠ¤ë¡œ ê°€ìš”.'],
    'ì„œë¡œ': ['ì„œë¡œ ë„ì™€ìš”.','ì„œë¡œ ì´í•´í•´ìš”.','ì„œë¡œ ì¡´ì¤‘í•´ìš”.'],
    'ì–¸ì œë‚˜': ['ì–¸ì œë‚˜ ì‘ì›í•´ìš”.','ì–¸ì œë‚˜ ê°ì‚¬í•´ìš”.','ì–¸ì œë‚˜ ë°”ë¹ ìš”.'],
    'ì˜¤ë˜': ['ì˜¤ë˜ ê¸°ë‹¤ë ¤ìš”.','ì˜¤ë˜ ì¼í•´ìš”.','ì˜¤ë˜ ì‚´ê³  ì‹¶ì–´ìš”.'],
    'ë©€ë¦¬': ['ë©€ë¦¬ ê°€ìš”.','ë©€ë¦¬ ì´ì‚¬í•´ìš”.','ë©€ë¦¬ ë³´ì—¬ìš”.'],
    'ì¡°ìš©íˆ': ['ì¡°ìš©íˆ ì½ì–´ìš”.','ì¡°ìš©íˆ ë“¤ì–´ìš”.','ì¡°ìš©íˆ ë‚˜ê°€ìš”.'],
    'ìê¾¸': ['ìê¾¸ ìŠì–´ë²„ë ¤ìš”.','ìê¾¸ ëŠ¦ì–´ìš”.','ìê¾¸ ì „í™”í•´ìš”.'],
    'ì œëŒ€ë¡œ': ['ì œëŒ€ë¡œ í•´ìš”.','ì œëŒ€ë¡œ ë¨¹ì–´ìš”.','ì œëŒ€ë¡œ ì‰¬ì–´ìš”.'],
    'ì ì ': ['ì ì  ì¢‹ì•„ì ¸ìš”.','ì ì  ì¶”ì›Œì ¸ìš”.','ì ì  ë¹¨ë¼ì ¸ìš”.'],
    'ì§ì ‘': ['ì§ì ‘ í™•ì¸í•´ìš”.','ì§ì ‘ ê°€ìš”.','ì§ì ‘ ë§Œë“¤ì–´ìš”.'],
    'ë˜': ['ë˜ ë§Œë‚˜ìš”.','ë˜ ë§Œë‚˜ì„œ ë°˜ê°€ì›Œìš”.','ë˜ ì „í™”í• ê²Œìš”.'],
    'ì£¼ë¡œ': ['ì£¼ë¡œ ì§‘ì—ì„œ ê³µë¶€í•´ìš”.','ì£¼ë¡œ ì•„ì¹¨ì— ìš´ë™í•´ìš”.','ì£¼ë¡œ ë²„ìŠ¤ë¥¼ íƒ€ìš”.'],
    'ì¯¤': [`${timeNouns[0]}ì¯¤ ê°€ìš”.`,`${timeNouns[1]}ì¯¤ ê°€ìš”.`,`${timeNouns[2]}ì¯¤ ë§Œë‚˜ìš”.`],
    'ê°‘ìê¸°': ['ê°‘ìê¸° ë¹„ê°€ ì™€ìš”.','ê°‘ìê¸° ì „í™”ê°€ ì™€ìš”.','ê°‘ìê¸° ë°”ë¹ ìš”.'],
    'ë”°ë¡œ': ['ë”°ë¡œ ê³„ì‚°í•´ìš”.','ë”°ë¡œ ê°€ìš”.','ë”°ë¡œ ì‚´ì•„ìš”.'],
    'ê·¸ëƒ¥': ['ê·¸ëƒ¥ ì‰¬ì–´ìš”.','ê·¸ëƒ¥ ê°€ìš”.','ê·¸ëƒ¥ ë¨¹ì–´ìš”.'],
    'ê·¸ë™ì•ˆ': ['ê·¸ë™ì•ˆ ì˜ ì§€ëƒˆì–´ìš”.','ê·¸ë™ì•ˆ ë°”ë¹´ì–´ìš”.','ê·¸ë™ì•ˆ ê³µë¶€í–ˆì–´ìš”.'],
    'ê·¸ë˜ë„': ['ê·¸ë˜ë„ ë…¸ë ¥í•´ìš”.','ê·¸ë˜ë„ ê´œì°®ì•„ìš”.','ê·¸ë˜ë„ ê°€ìš”.'],
    'ëœ': ['ëœ ë¨¹ì–´ìš”.','ëœ ë§ˆì…”ìš”.','ëœ ììš”.'],
    'ë¹ ì§ì—†ì´': ['ë¹ ì§ì—†ì´ ì°¸ì„í•´ìš”.','ë¹ ì§ì—†ì´ ê¸°ë¡í•´ìš”.','ë¹ ì§ì—†ì´ í™•ì¸í•´ìš”.'],
    'ì •í™•íˆ': ['ì •í™•íˆ ê¸°ì–µí•´ìš”.','ì •í™•íˆ ë§í•´ìš”.','ì •í™•íˆ ë„ì°©í•´ìš”.'],
    'í˜¼ì': ['í˜¼ì ê³µë¶€í•´ìš”.','í˜¼ì ê°€ìš”.','í˜¼ì ì‚´ì•„ìš”.'],
    'í•¨ë¶€ë¡œ': ['í•¨ë¶€ë¡œ ë§í•´ìš”.','í•¨ë¶€ë¡œ í•˜ì§€ ë§ˆì„¸ìš”.','í•¨ë¶€ë¡œ ë²„ë ¤ìš”.'],
    'ê³§ì¥': ['ê³§ì¥ ì§‘ì— ê°€ìš”.','ê³§ì¥ íšŒì‚¬ë¡œ ê°€ìš”.','ê³§ì¥ ì—°ë½í•´ìš”.'],
    'ê¸‰íˆ': ['ê¸‰íˆ ë– ë‚˜ìš”.','ê¸‰íˆ ì¤€ë¹„í•´ìš”.','ê¸‰íˆ ë„ì™€ìš”.'],
    'ë‚ ë§ˆë‹¤': ['ë‚ ë§ˆë‹¤ ìš´ë™í•´ìš”.','ë‚ ë§ˆë‹¤ ê¸°ë¡í•´ìš”.','ë‚ ë§ˆë‹¤ ì „í™”í•´ìš”.'],
    'ëŒ€ì²´ë¡œ': ['ëŒ€ì²´ë¡œ ì¢‹ì•„ìš”.','ëŒ€ì²´ë¡œ ì¡°ìš©í•´ìš”.','ëŒ€ì²´ë¡œ ê´œì°®ì•„ìš”.'],
    'ë‹¹ì¥': ['ë‹¹ì¥ ì‹œì‘í•´ìš”.','ë‹¹ì¥ ê°€ìš”.','ë‹¹ì¥ í™•ì¸í•´ìš”.'],
    'ë§‰': ['ë§‰ ì‹œì‘í•´ìš”.','ë§‰ ëë‚¬ì–´ìš”.','ë§‰ ì™”ì–´ìš”.'],
    'ë°˜ë“œì‹œ': ['ë°˜ë“œì‹œ ì„±ê³µí•´ìš”.','ë°˜ë“œì‹œ ê°€ìš”.','ë°˜ë“œì‹œ ì§€ì¼œìš”.'],
    'ì‚´ì§': ['ì‚´ì§ ì—´ì–´ìš”.','ì‚´ì§ ë°€ì–´ìš”.','ì‚´ì§ ì›ƒì–´ìš”.'],
    'ì•„ë§ˆ': ['ì•„ë§ˆ ê°€ìš”.','ì•„ë§ˆ ë§ì•„ìš”.','ì•„ë§ˆ ëŠ¦ì–´ìš”.'],
    'ì—­ì‹œ': ['ì—­ì‹œ ìµœê³ ì˜ˆìš”.','ì—­ì‹œ ì–´ë µë„¤ìš”.','ì—­ì‹œ ë§ì•„ìš”.'],
    'ì¢…ì¢…': ['ì¢…ì¢… ê°€ìš”.','ì¢…ì¢… ë§Œë‚˜ê³  ìˆì–´ìš”.','ì¢…ì¢… ì—°ë½í•´ìš”.'],
    'ì¤„ê³§': ['ì¤„ê³§ ê³µë¶€í•´ìš”.','ì¤„ê³§ ì¼í•´ìš”.','ì¤„ê³§ ê¸°ë‹¤ë ¤ìš”.'],
    'ì°¨ë¡€ë¡œ': ['ì°¨ë¡€ë¡œ ë“¤ì–´ê°€ìš”.','ì°¨ë¡€ë¡œ ì½ì–´ìš”.','ì°¨ë¡€ë¡œ ë°œí‘œí•´ìš”.'],
    'ì¶©ë¶„íˆ': ['ì¶©ë¶„íˆ ì‰¬ì–´ìš”.','ì¶©ë¶„íˆ ë¨¹ì–´ìš”.','ì¶©ë¶„íˆ ì—°ìŠµí•´ìš”.'],
    'ìµœê·¼': ['ìµœê·¼ ìš´ë™í•´ìš”.','ìµœê·¼ ë°”ë¹ ìš”.','ìµœê·¼ ë°°ì› ì–´ìš”.'],
    'ìµœì†Œí•œ': ['ìµœì†Œí•œ ì‹œë„í•´ìš”.','ìµœì†Œí•œ ì—°ë½í•´ìš”.','ìµœì†Œí•œ ì‰¬ì–´ìš”.'],
    'ìµœëŒ€í•œ': ['ìµœëŒ€í•œ ë…¸ë ¥í•´ìš”.','ìµœëŒ€í•œ ë¹¨ë¦¬ ê°ˆê²Œìš”.','ìµœëŒ€í•œ ë„ì™€ì¤„ê²Œìš”.'],
    'í”íˆ': ['í”íˆ ë§í•´ìš”.','í”íˆ ìˆì–´ìš”.','í”íˆ ë´ìš”.'],
    'í˜¹ì‹œ': ['í˜¹ì‹œ ì‹œê°„ ìˆì–´ìš”?','í˜¹ì‹œ ë‚´ì¼ ê°€ëŠ¥í•´ìš”?','í˜¹ì‹œ ê¸¸ ì•Œì•„ìš”?'],
    'í˜„ì¬': ['í˜„ì¬ ì§„í–‰í•´ìš”.','í˜„ì¬ ì¤€ë¹„ ì¤‘ì´ì—ìš”.','í˜„ì¬ íšŒì˜ ì¤‘ì´ì—ìš”.'],
    'í™•ì‹¤íˆ': ['í™•ì‹¤íˆ ë§ì•„ìš”.','í™•ì‹¤íˆ ë‹¬ë¼ìš”.','í™•ì‹¤íˆ ì¢‹ì•„ìš”.'],
    'í›¨ì”¬': ['í›¨ì”¬ ì¢‹ì•„ìš”.','í›¨ì”¬ ë¹¨ë¼ìš”.','í›¨ì”¬ ì‰¬ì›Œìš”.'],
    'ëª¨ë‘ë“¤': ['ëª¨ë‘ë“¤ ì™”ì–´ìš”.','ëª¨ë‘ë“¤ ë“¤ì–´ì™”ì–´ìš”.','ëª¨ë‘ë“¤ ë¨¹ì—ˆì–´ìš”.'],
    'ëª°ë˜': ['ëª°ë˜ ë‚˜ê°€ìš”.','ëª°ë˜ ì¤€ë¹„í•´ìš”.','ëª°ë˜ ë´ìš”.'],
    'ë¬´ì¡°ê±´': ['ë¬´ì¡°ê±´ ê°€ìš”.','ë¬´ì¡°ê±´ í•´ìš”.','ë¬´ì¡°ê±´ ë¯¿ì–´ìš”.'],
    'ì„œë¡œì„œë¡œ': ['ì„œë¡œì„œë¡œ ë„ì™€ìš”.','ì„œë¡œì„œë¡œ ì¸ì‚¬í•´ìš”.','ì„œë¡œì„œë¡œ ë°°ì›Œìš”.'],
    'ìŠ¬ìŠ¬': ['ìŠ¬ìŠ¬ ê°€ìš”.','ìŠ¬ìŠ¬ ì‹œì‘í•´ìš”.','ìŠ¬ìŠ¬ ì¡¸ë ¤ìš”.'],
    'ì–µì§€ë¡œ': ['ì–µì§€ë¡œ í•´ìš”.','ì–µì§€ë¡œ ë¨¹ì–´ìš”.','ì–µì§€ë¡œ ì›ƒì–´ìš”.'],
    'í˜¹ì€': ['ë°¥ í˜¹ì€ ë¹µì„ ë¨¹ì–´ìš”.','ì»¤í”¼ í˜¹ì€ ë¬¼ì„ ë§ˆì…”ìš”.','ë²„ìŠ¤ í˜¹ì€ ì§€í•˜ì² ì„ íƒ€ìš”.']
  };

  function randomItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function buildGenericSentence(adv){
    const useSubject = Math.random() < 0.5;
    const subj = randomItem(subjects);
    const verb = randomItem(Math.random() < 0.5 ? intransVerbs : transVerbs.map(x=>x.v));
    const needsObj = transVerbs.some(x=>x.v===verb && x.obj) && Math.random() < 0.7;
    const obj = needsObj ? (randomItem(objectsPool)+' ') : '';
    const left = useSubject ? (subj+' ') : '';
    return `${left}${adv} ${obj}${verb}.`;
  }
  function makeSentence(adv, prev=''){
    for(let tries=0; tries<10; tries++){
      let s;
      if(specials[adv] && Math.random()<0.4) s = randomItem(specials[adv]);
      else s = buildGenericSentence(adv);
      if(s !== prev) return s;
    }
    return buildGenericSentence(adv);
  }

  // ===== WORD-BY-WORD GLOSS =====
  const GLOSS = {
    'ì €ëŠ”':'I (TOP)','ìš°ë¦¬ëŠ”':'we (TOP)','ì¹œêµ¬ëŠ”':'friend (TOP)','ì•„ì´ë“¤ì€':'children (TOP)','ì„ ìƒë‹˜ì€':'teacher (TOP)',
    'ê·¸ëŠ”':'he (TOP)','ê·¸ë…€ëŠ”':'she (TOP)','ì‚¬ëŒë“¤ì€':'people (TOP)','ë¹„ê°€':'rain (SUBJ)','ê³ ì–‘ì´ëŠ”':'cat (TOP)','ê°•ì•„ì§€ëŠ”':'puppy (TOP)',
    'ë°¥ì„':'rice (ACC)','ë¹µì„':'bread (ACC)','ë¬¼ì„':'water (ACC)','ì»¤í”¼ë¥¼':'coffee (ACC)','ì±…ì„':'book (ACC)','ì˜í™”ë¥¼':'movie (ACC)',
    'í•œêµ­ì–´ë¥¼':'Korean (ACC)','ìˆ™ì œë¥¼':'homework (ACC)','ë°©ì„':'room (ACC)','ì§‘ì„':'house (ACC)','ì—°ìŠµì„':'practice (ACC)',
    'ë¬¸ì œë¥¼':'problem (ACC)','ì¹œêµ¬ë¥¼':'friend (ACC)','ì‹œê°„ì„':'time (ACC)','ë°¥':'rice','ë¹µ':'bread','ì‹œê°„':'time','ì§‘':'home','ì§‘ì—':'to home','ì§‘ì—ì„œ':'at home',
    'ë³„ë¡œ':'not really','ì•„ì§':'still / not yet','ë²Œì¨':'already','ë‹¤ì‹œ':'again','ë§ì´':'a lot','ì˜':'well','ì²œì²œíˆ':'slowly',
    'í•­ìƒ':'always','ë¨¼ì €':'first','ì œì¼':'most','ì•„ì£¼':'very','ë„ˆë¬´':'too (very)','ê¼­':'surely','ì •ë§':'really',
    'ì¡°ê¸ˆ':'a little','ì¢€':'a bit','ê°™ì´':'together','ê³§':'soon','ë‚˜ì¤‘ì—':'later','ì•„ê¹Œ':'earlier','ë¯¸ë¦¬':'in advance',
    'íŠ¹íˆ':'especially','ìš°ì„ ':'first of all','ëª¨ë‘':'everyone','ë³´í†µ':'usually','ì„œë¡œ':'each other','ì–¸ì œë‚˜':'always',
    'ì˜¤ë˜':'for long','ë©€ë¦¬':'far','ì¡°ìš©íˆ':'quietly','ìê¾¸':'repeatedly','ì œëŒ€ë¡œ':'properly','ì ì ':'gradually',
    'ì§ì ‘':'directly','ë˜':'again/also','ì£¼ë¡œ':'mainly','ì¯¤':'around','í˜¹ì€':'or','í˜¹ì‹œ':'perhaps',
    'ê°‘ìê¸°':'suddenly','ë”°ë¡œ':'separately','ê·¸ëƒ¥':'just','ê·¸ë™ì•ˆ':'in the meantime','ê·¸ë˜ë„':'still/yet',
    'ëœ':'less','ë¹ ì§ì—†ì´':'without exception','ì •í™•íˆ':'accurately','í˜¼ì':'alone','í•¨ë¶€ë¡œ':'carelessly',
    'ê³§ì¥':'straight','ê¸‰íˆ':'hastily','ë‚ ë§ˆë‹¤':'every day','ëŒ€ì²´ë¡œ':'generally','ë‹¹ì¥':'right away','ë§‰':'just now',
    'ë°˜ë“œì‹œ':'absolutely','ì‚´ì§':'slightly','ì•„ë§ˆ':'probably','ì—­ì‹œ':'as expected','ì¢…ì¢…':'occasionally','ì¤„ê³§':'continually',
    'ì°¨ë¡€ë¡œ':'in order','ì¶©ë¶„íˆ':'sufficiently','ìµœê·¼':'recently','ìµœì†Œí•œ':'at least','ìµœëŒ€í•œ':'as much as possible',
    'í”íˆ':'often','í˜„ì¬':'currently','í™•ì‹¤íˆ':'surely','í›¨ì”¬':'much (more)','ëª¨ë‘ë“¤':'everyone','ëª°ë˜':'secretly',
    'ë¬´ì¡°ê±´':'unconditionally','ì„œë¡œì„œë¡œ':'with each other','ìŠ¬ìŠ¬':'slowly','ì–µì§€ë¡œ':'by force',
    'ê°€ìš”':'go','ì™€ìš”':'come','ì¼í•´ìš”':'work','ìš´ë™í•´ìš”':'exercise','ì‰¬ì–´ìš”':'rest','ììš”':'sleep','ê³µë¶€í•´ìš”':'study','ì‚°ì±…í•´ìš”':'take a walk',
    'ì›ƒì–´ìš”':'laugh','ìš¸ì–´ìš”':'cry','ì—°ë½í•´ìš”':'contact','ì „í™”í•´ìš”':'call','ì¶œë°œí•´ìš”':'depart','ë„ì°©í•´ìš”':'arrive','ë§ì•„ìš”':'be correct',
    'ì§„í–‰í•´ìš”':'proceed','ì‹œì‘í•´ìš”':'start','ëë‚˜ìš”':'finish','ëª¨ì—¬ìš”':'gather','ë§Œë‚˜ìš”':'meet','ë– ë‚˜ìš”':'leave','ë‚˜ê°€ìš”':'go out',
    'ë¨¹ì–´ìš”':'eat','ë§ˆì…”ìš”':'drink','ì½ì–´ìš”':'read','ë°°ì›Œìš”':'learn','ê¸°ë‹¤ë ¤ìš”':'wait','ë§Œë“¤ì–´ìš”':'make','ë´ìš”':'see/watch',
    'ì²­ì†Œí•´ìš”':'clean','ì¤€ë¹„í•´ìš”':'prepare','ë„ì™€ìš”':'help','ì‚¬ìš”':'buy','íŒ”ì•„ìš”':'sell','ì¢‹ì•„í•´ìš”':'like','ê³„ì‚°í•´ìš”':'pay/calc',
    'ì°¸ì„í•´ìš”':'attend','ê¸°ì–µí•´ìš”':'remember','í™•ì¸í•´ìš”':'check','ì—´ì–´ìš”':'open','ì‘ì›í•´ìš”':'support','ì‹œë„í•´ìš”':'try',
    'ìˆì–´ìš”':'exist/have','ì¢‹ì•„ìš”':'is good','ì¢‹ì•„ì ¸ìš”':'get better','ì—´ì–´ìš”.':'open',
    'ì„¸':'three','ë„¤':'four','ì‹œ':"o'clock",'ì‹œì¯¤':"around o'clock",'ë‚´ì¼':'tomorrow','ì£¼ë§':'weekend','ë‹¤ìŒ':'next','ë‹¤ìŒ ì£¼':'next week',
    'ì´ë²ˆ':'this','ì´ë²ˆ ì£¼':'this week','ì´ë²ˆ ë‹¬':'this month','ì˜¬í•´':'this year'
  };

  const sanitize = (tok)=>tok.replace(/[.,!?â€¦]/g,'').trim();
  function glossForSentence(sentence, adv){
    const advEnglish = current?.en || '';
    const tokens = sentence.split(/\s+/).filter(Boolean);
    const chunks = tokens.map(t=>{
      const clean = sanitize(t);
      let en = GLOSS[clean];
      if(!en && clean.endsWith('ìš”')) en = GLOSS[clean];
      if(!en && clean === adv) en = advEnglish;
      if(!en && clean.endsWith('ì¯¤')) en = 'around';
      if(!en) en = 'â€”';
      return {ko:t.replace(/\s+/g,' '), en};
    });
    return chunks;
  }

  // ===== CHOICES (English meaning) =====
  function generateChoicesFor(currentWord){
    const correct = currentWord.en;
    const pool = [];
    for(const w of WORDS_MASTER){
      if(w.en && w.en !== correct && !pool.includes(w.en)) pool.push(w.en);
    }
    shuffle(pool);
    const distractors = pool.slice(0,3);
    return shuffle([correct, ...distractors]).map(text => ({ text, correct: text === correct }));
  }

  function renderChoicesFor(word){
    choicesGrid.innerHTML = '';
    if(!toggleChoices.checked) { choicesGrid.style.display = 'none'; return; }
    choicesGrid.style.display = 'grid';
    const options = generateChoicesFor(word);
    let locked = false;

    for(const opt of options){
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'choiceBtn';
      btn.textContent = opt.text;
      btn.dataset.correct = opt.correct ? '1' : '0';
      btn.addEventListener('click', (e)=>{
        e.stopPropagation(); // prevent flip
        if(locked) return;
        locked = true;
        if(opt.correct){
          btn.classList.add('correct');
        }else{
          btn.classList.add('wrong');
          [...choicesGrid.children].forEach(ch=>{
            if(ch.dataset.correct === '1'){ ch.classList.add('reveal'); }
          });
        }
      });
      choicesGrid.appendChild(btn);
    }
  }
  toggleChoices.addEventListener('change', ()=>{ if(current) renderChoicesFor(current); });

  // ===== RENDERING =====
  function renderFront(w){
    front.innerHTML = `
      <div class="ko-row">
        <div class="ko" aria-label="Korean adverb">${w.ko}</div>
        <button class="play-base" id="playBaseFront" title="Play base" aria-label="Play base">ğŸ”Š Play</button>
      </div>
      <div class="controls" style="margin-top:10px">
        <button class="btn" id="flipToBack"> FLIP the CARD</button>
      </div>
    `;
    front.querySelector('#playBaseFront').addEventListener('click', (e)=>{ e.stopPropagation(); playKo(w.ko); });
    front.querySelector('#flipToBack').addEventListener('click', (e)=>{ e.stopPropagation(); flipWrap.classList.add('flipped'); });
  }

  function renderBack(w){
    const firstSentence = makeSentence(w.ko);
    const glossChunks = glossForSentence(firstSentence, w.ko);

    back.innerHTML = `
      <div class="enhead ko-big">${w.ko}</div>
      <ul class="enlines">
        <li><b>Meaning</b> <span class="koform">${w.en} / ${w.tl}</span></li>
      </ul>
      <div class="sentence" id="sentBox">${firstSentence}</div>
      <div class="gloss" id="glossBox">
        ${glossChunks.map(c=>`<span class="gchunk"><span class="gko">${c.ko}</span><span class="gen">${c.en}</span></span>`).join('')}
      </div>
      <div class="controls" style="margin-top:6px">
        <button class="btn ghost" id="flipToFront">â—€ Back</button>
        <button class="btn" id="nextBtn">Next â–¶</button>
        <button class="btn" id="newSentBtn">New sentence</button>
        <button class="btn" id="playSentBtn">ğŸ”Š Sentence</button>
        <button class="btn" id="playBaseBack">ğŸ”Š Base</button>
      </div>
    `;

    const rerenderSentence = ()=>{
      const prev = document.getElementById('sentBox').textContent;
      const s = makeSentence(w.ko, prev);
      document.getElementById('sentBox').textContent = s;
      const chunks = glossForSentence(s, w.ko);
      document.getElementById('glossBox').innerHTML =
        chunks.map(c=>`<span class="gchunk"><span class="gko">${c.ko}</span><span class="gen">${c.en}</span></span>`).join('');
    };

    back.querySelector('#nextBtn').addEventListener('click', (e)=>{ e.stopPropagation(); nextCardAnimated(); });
    back.querySelector('#playBaseBack').addEventListener('click', (e)=>{ e.stopPropagation(); playKo(w.ko); });
    back.querySelector('#flipToFront').addEventListener('click', (e)=>{ e.stopPropagation(); flipWrap.classList.remove('flipped'); });
    back.querySelector('#newSentBtn').addEventListener('click', (e)=>{ e.stopPropagation(); rerenderSentence(); });
    back.querySelector('#playSentBtn').addEventListener('click', (e)=>{
      e.stopPropagation();
      const s = document.getElementById('sentBox').textContent;
      playKo(s);
    });
  }

  function showCard(w){
    current = w;
    renderFront(w);
    renderBack(w);
    flipWrap.classList.remove('flipped');
    updateProgress();
    renderChoicesFor(w);   // â† build choices for this word
    playKo(w.ko);          // autoplay base once
  }

  // ===== FLOW =====
  function startRun(){
    queue = shuffle([...WORDS_MASTER]);
    index = 0;
    finish.style.display = 'none';
    showCard(queue[index]);
  }

  function nextCardAnimated(){
    if(isAnimating) return;
    isAnimating = true;
    flipWrap.classList.add('animating','fly-exit');

    const onExitEnd = (e)=>{
      if(e.target !== cardEl) return;
      flipWrap.removeEventListener('animationend', onExitEnd);
      flipWrap.classList.remove('fly-exit');

      index++;
      if(index >= queue.length){
        flipWrap.classList.remove('animating');
        isAnimating = false;
        finish.style.display = 'flex';
        return;
      }

      const w = queue[index];
      renderFront(w);
      renderBack(w);
      flipWrap.classList.remove('flipped');
      updateProgress();

      // refresh choices for new card
      renderChoicesFor(w);

      flipWrap.classList.add('fly-enter');
      const onEnterEnd = (ev)=>{
        if(ev.target !== cardEl) return;
        flipWrap.removeEventListener('animationend', onEnterEnd);
        flipWrap.classList.remove('fly-enter','animating');
        isAnimating = false;
        playKo(w.ko);
      };
      flipWrap.addEventListener('animationend', onEnterEnd);
    };
    flipWrap.addEventListener('animationend', onExitEnd);
  }

  // Click / tap
  flipWrap.addEventListener('click', ()=>{
    if(!current) return;
    if(!flipWrap.classList.contains('flipped')) flipWrap.classList.add('flipped');
    else nextCardAnimated();
  });

  // Keyboard
  cardEl.addEventListener('keydown', (e)=>{
    if(e.code==='Enter' || e.code==='Space'){
      e.preventDefault();
      if(!flipWrap.classList.contains('flipped')) flipWrap.classList.add('flipped');
      else nextCardAnimated();
    }
  });

  // Start / Restart
  document.getElementById('startBtn').addEventListener('click', ()=>{ audioReady = true; gate.style.display = 'none'; startRun(); });
  document.getElementById('restartBtn').addEventListener('click', ()=>{ gate.style.display = 'none'; audioReady = true; startRun(); });
  </script>

  <script>
  // Disable right click
  document.addEventListener("contextmenu", function(e){ e.preventDefault(); }, false);
  // Disable text selection
  document.addEventListener("selectstart", function(e){ e.preventDefault(); }, false);
  // Disable drag
  document.addEventListener("dragstart", function(e){ e.preventDefault(); }, false);
  // Disable certain keys (F12, Ctrl+U/S/C/X/V)
  document.addEventListener("keydown", function(e){
    if (e.key === "F12" || (e.ctrlKey && ["u","s","c","x","v"].includes(e.key.toLowerCase()))) { e.preventDefault(); }
  }, false);
  </script>

</body>
</html>
