<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EPS-TOPIK Vocabulary Trainer</title>
<style>
  :root{
    --bg:#0a1522; --panel:#0f1f33; --ink:#eaf2ff; --muted:#a8bed8;
    --accent:#38bdf8; --accent-2:#22d3ee; --line:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;
    background:linear-gradient(180deg,#08121d,#0a1522 60%,#06101b);
    color:var(--ink);
  }
  header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg,rgba(10,21,34,.95),rgba(10,21,34,.85));
    backdrop-filter: blur(6px) saturate(120%);
    padding:16px 14px; border-bottom:1px solid var(--line);
  }
  h1{margin:0; font-size:1.2rem; letter-spacing:.4px}
  .wrap{max-width:1000px; margin:14px auto 60px; padding:0 12px}

  .toolbar{
    display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; margin:12px 0 10px;
  }
  .toolbar input{
    padding:10px 12px; border-radius:10px; border:1px solid var(--line);
    background:#0b1a2b; color:var(--ink); outline:none;
  }
  .toolbar button{
    appearance:none; border:none; cursor:pointer;
    padding:10px 14px; border-radius:10px; font-weight:800; letter-spacing:.3px;
    background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#062135;
  }

  .filters{ display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 10px; }
  .pill{
    border:1px solid var(--line); border-radius:999px; padding:7px 12px; font-weight:700; font-size:.92rem;
    background:#0b1a2b; color:#cfe3ff; cursor:pointer; user-select:none;
    transition:filter .15s ease, transform .06s ease;
  }
  .pill:hover{filter:brightness(1.08)}
  .pill:active{transform:translateY(1px)}
  .pill.active{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#062135}

  .list{
    border:1px solid var(--line); border-radius:14px; overflow:hidden;
    background:linear-gradient(180deg,#0e1e30,#0b1929);
  }
  /* 3 columns: Page | KO/EN | Audio */
  .head, .row{
    display:grid; grid-template-columns: 48px 1fr 54px;
    align-items:center; gap:6px; padding:10px 12px; border-bottom:1px solid var(--line);
  }
  .head{position:sticky; top:0px; background:#10213a; z-index:5; font-weight:800; color:#cfe3ff}
  .row{position:relative}
  .row:last-child{border-bottom:none}

  /* Page number smaller */
  .num{
    font-variant-numeric: tabular-nums; color:#b9d8ff; font-weight:800;
    font-size:.85rem; opacity:.95;
  }

  /* Combined KO + EN */
  .koen{display:flex; flex-direction:column; gap:4px; min-width:0}
  .ko-line{
    font-weight:900; font-size:1.02rem; display:flex; align-items:center; gap:8px;
    overflow-wrap:anywhere; word-break:break-word;
  }
  .en-line{
    color:#cfe0fb; font-size:.93rem; line-height:1.15;
    overflow-wrap:anywhere; word-break:break-word;
  }

  .play{
    justify-self:end; width:40px; height:40px; border-radius:10px; display:grid; place-items:center;
    background:#0b1a2b; border:1px solid var(--line); cursor:pointer; transition:transform .08s ease, filter .15s ease;
  }
  .play:hover{filter:brightness(1.08); transform:translateY(-1px)}
  .play svg{width:20px; height:20px; fill:#7fd6ff}

  .toggle{
    width:18px; height:18px; border:1px solid var(--line); border-radius:4px; display:inline-grid; place-items:center;
    background:#092039; font-size:12px; line-height:1; cursor:pointer; user-select:none;
    flex:0 0 auto;
  }

  .exp{
    grid-column: 1 / -1; padding:10px 14px 12px; background:rgba(255,255,255,.03); border-top:1px solid var(--line);
    display:none; border-bottom-left-radius:12px; border-bottom-right-radius:12px;
  }
  .row.open + .exp{display:block}
.chips{display:flex; gap:10px; flex-wrap:wrap}
.chip{
  padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#0b1a2b;
  display:flex; flex-direction:column; gap:6px; align-items:flex-start;
}
.chip-title{ font-weight:800; color:#9bd7ff; line-height:1 }
.chip-ko{ display:flex; align-items:center; gap:8px; }
.chip .form{
  font-weight:800;
  white-space:nowrap;           /* keep Korean on one line */
  overflow-x:auto;              /* allow sideways scroll on small screens */
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.chip .form::-webkit-scrollbar{ display:none; } /* hide scrollbar for WebKit */
.chip-en{ color:var(--muted); line-height:1.2 }
.play-mini{
  width:30px; height:30px; border-radius:8px; border:1px solid var(--line);
  background:#0b1a2b; display:grid; place-items:center; cursor:pointer;
}
.play-mini svg{ width:16px; height:16px; fill:#7fd6ff }

/* Mobile spacing */
@media (max-width:520px){
  .chip{ gap:5px; }
  .chip-title{ font-size:.95rem; }
  .chip-en{ font-size:.94rem; }
}

  .nohit{padding:18px; color:var(--muted)}
  mark{background:rgba(56,189,248,.22); color:#e8fbff; padding:0 .18em; border-radius:4px}

  /* ===== Floating Home button (unchanged) ===== */
  .floating-home{
    position:fixed; top:0; right:0;
    background:linear-gradient(90deg, var(--cyan, #67e8f9), var(--accent, #38bdf8));
    color:#072235; font-size:14px; font-weight:700; text-decoration:none;
    padding:8px 16px; border-radius:0 0 0 10px;
    box-shadow:0 6px 18px rgba(56,189,248,.35);
    z-index:9999; transition:all .25s ease;
    backdrop-filter:blur(8px) saturate(140%); -webkit-backdrop-filter:blur(8px) saturate(140%);
  }
  .floating-home:hover{
    filter:brightness(1.12);
    box-shadow:0 0 12px rgba(56,189,248,.55), 0 0 24px rgba(103,232,249,.45);
    transform:translateY(-1px);
  }

  /* ===== Mobile tweaks ===== */
  @media (max-width: 520px){
    .head, .row{ grid-template-columns: 42px 1fr 46px; gap:6px; padding:8px 10px; }
    .num{ font-size:.8rem; }
    .ko-line{ font-size:.96rem; }
    .en-line{ font-size:.86rem; }
    .play{ width:36px; height:36px; border-radius:8px; }
    .chip{ padding:7px 8px; }
    .chip .form{ font-size:.95em; }
    .wrap{ margin:10px auto 56px; }
  }
</style>
</head>
<body>
  <a href="index.html" class="floating-home">Home</a>

  <header>
    <h1>EPS-TOPIK BOOK 2 — Vocabulary Trainer</h1>
  </header>

  <div class="wrap">
    <div class="filters" id="filters">
      <span class="pill active" data-cat="all">ALL</span>
      <span class="pill" data-cat="noun">Nouns</span>
      <span class="pill" data-cat="verb">Verbs</span>
      <span class="pill" data-cat="adjective">Adjectives</span>
      <span class="pill" data-cat="adverb">Adverbs</span>
    </div>

    <div class="toolbar">
      <input id="q" type="search" placeholder="Search… (e.g., 'doctor', '병원', '94')" />
      <button id="clearBtn" type="button">Clear</button>
    </div>

    <div class="list" id="list">
      <div class="head">
        <div>Pg</div><div>Term (Korean / English)</div><div style="text-align:right">Audio</div>
      </div>
    </div>
    <div class="nohit" id="nohit" style="display:none">No matches.</div>
  </div>

<script>
/* ========= Raw list (exact order) ========= */
const RAW = `
갈아입다 to change one's clothes 17
그렇다 to be like that 17
넥타이 tie 17
단정하다 to be neat 17
단추 button 17
매다 to tie 17
벗다 to take off 17
복장 attire 17
새 new 17
안전(하다) safety, to be safe 17
양복 business suit 17
익숙해지다 to become accustomed to 17
작업(하다) work, to work 17
작업복 work clothes 17
잠그다 to button up 17
정장 formal wear 17
지퍼 zipper 17
공장 factory 20
공장장 factory manager 20
긍정적 to be positive 20
다행 fortunate thing 20
무시(하다) ignorance, to ignore 20
배려(하다) consideration, to act considerately 20
부정적이다 to be negative 20
불쾌하다 to be displeased 20
사용(하다) usage, to use 20
서로 each other 20
성실하다 to be diligent 20
의견 opinion 20
존댓말 honorifics 20
존중(하다) respect, to respect 20
참 really 20
칭찬(하다) compliment, to compliment 20
태도 attitude 20
피해를 주다 to cause harm 20
함부로 carelessly 20
항상 always 20
계단 stairs 27
공용 communal 27
관리인 caretaker 27
규칙 regulation 27
다른 other/different 27
데려오다 to bring (someone) 27
복도 hallway 27
샤워실 shower room 27
세탁실 laundry room 27
어기다 to break (regulations) 27
조리실 kitchen 27
출입문 entrance 27
혼자 alone 27
가지다 to have 30
구내식당 cafeteria 30
끼리 together (between group members) 30
놓다 to place 30
담다 to put on (a plate) 30
도시락 lunchbox 30
미리 in advance 30
배식대 serving station 30
식권 meal ticket 30
식단표 menu board 30
식수대 water station 30
퇴식구 tray return area 30
할인되다 to be discounted 30
격려(하다) encouragement, to encourage 37
규율 rule 37
모두 everyone 37
부하 subordinate 37
분위기 atmosphere 37
사이 relationship 37
상사 boss 37
엄격하다 to be strict 37
위해 주다 to care for 37
윗분 superior 37
자유롭다 to be free/lenient 37
잘하다 to do well 37
정도 degree 37
지내다 to spend time 37
직장 workplace 37
친하다 to be close (friends) 37
힘내다 to stay strong 37
가끔 sometimes 40
관계 relationship 40
그래도 still, even though 40
놀리다 to tease 40
따르다 to follow 40
말다툼(하다) argument, to argue 40
무섭다 to be scary 40
믿다 to trust 40
부장 bujang, department head 40
사고가 나다 to have an accident 40
사과(하다) apology, to apologize 40
생각(하다) thought, to think 40
소리를 지르다 to yell 40
아끼다 to cherish 40
에게/한테 to (someone) 40
오해(하다) misunderstanding, to misunderstand 40
의지(하다) reliance, to rely on 40
자꾸 repeatedly 40
잔소리(하다) nagging, to nag 40
짜증을 내다 to get irritated 40
화를 내다 to get angry 40
화해(하다) reconciliation, to reconcile 40
거부감 a sense of repulsion 47
깜짝 with a startle 47
놀라다 to be shocked 47
농담 joke 47
느끼다 to feel 47
문제 problem 47
불쾌감 discomfort 47
상대방 other person 47
성적 sexual 47
성차별적 sexist 47
성희롱 sexual harassment 47
수치심 shame 47
심하다 to be severe 47
ㅇ 아까 earlier 47
언어 language 47
예민하다 to be sensitive 47
음담패설 lewd comments 47
음란물 pornography 47
의도 intention 47
신체 접촉 physical contact 47
조심(하다) care/caution, to be careful 47
표정 facial expression 47
가해자 perpetrator 50
당하다 to suffer 50
대처(하다) handling, to handle 50
발생(하다) occurrence, to occur 50
분명하다 to be clear 50
상황 situation 50
성 인지 감수성 gender sensitivity 50
성범죄 sex crime 50
성별 gender 50
성추행 sexual assault 50
신고(하다) report, to report 50
알아차리다 to realize 50
양성평등 gender equality 50
예방(하다) prevention, to prevent 50
요구(하다) demand, to demand 50
의사 opinion 50
이해(하다) understanding, to understand 50
증거 evidence 50
증인 witness 50
차이 difference 50
표현(하다) expression, to express 50
피해자 victim 50
행동(하다) action, to act 50
확보(하다) securement, to secure 50
관리(하다) management, to manage 57
냄새 smell 57
도구 tool 57
먼저 first 57
소음 noisy 57
엉망이다 to be a mess 57
열다 to open 57
작업대 workbench 57
작업장 workplace 57
정리(하다) arrangement/organization, to arrange/organize 57
치우다 to clear up 57
쾌적하다 to be pleasant 57
환경 environment 57
환기(하다) ventilation, to ventilate 57
곧 soon 60
냉동 freezing 60
냉장 refrigeration 60
담당자 person in charge 60
덮개 cover 60
덮다 to cover 60
두다 to place 60
물류 logistics 60
보관(하다) storage, to store 60
온도 temperature 60
옮기다 to move 60
유지(하다) maintenance, to maintain 60
자재 materials 60
재고 inventory 60
저장(하다) storage, to store 60
적정 온도 proper temperature 60
중요하다 to be important 60
창고 warehouse 60
컨테이너 container 60
특히 especially 60
파악(하다) to check 60
-별 by (a category) 67
갖다 놓다 to bring and put 67
깨지다 to be broken 67
꼼꼼하다 to be meticulous 67
나르다 to carry 67
녹슬다 to rust 67
ㄹ 라벨 label 67
묶다 to tie 67
밀봉(하다) sealing, to seal 67
방청지 rust-proof paper 67
분류(하다) sorting, to sort 67
붙이다 to attach 67
손상되다 to get damaged 67
신경을 쓰다 to pay attention 67
쌓다 to stack 67
업체 company 67
완충재 cushioning material 67
운송(하다) shipping/transportation, to ship/transport 67
적재(하다) loading, to load 67
지시(하다) instruction, to instruct 67
크기 size 67
파렛트 pallet 67
포장 기준서 packaging instructions 67
검수(하다) inspection, to inspect 70
납품(하다) delivery of goods, to deliver 70
내리다 to unload 70
대차 dolly 70
(위에서) 떨어지다 to fall 70
맞추다 to adjust 70
밧줄 rope 70
빠짐없이 without exception, perfectly 70
수고(하다) putting in effort, to put in effort 70
수량 quantity 70
싣다 to load 70
운반(하다) transportation, to transport 70
입고(하다) receiving goods, to receive (goods) 70
주의(하다) caution, to take caution 70
중량 weight 70
지게차 forklift 70
출고(하다) release, to take out (goods) 70
출하(하다) shipment, to ship 70
출하량 shipment volume 70
핸드 카트 hand trolley 70
핸드 파렛트 hand pallet 70
기계 machine 77
끄다 to turn off 77
끼다 to get stuck 77
끼우다 to install/insert a part 77
당기다 to pull 77
레버 lever 77
멈추다 to stop 77
밀다 to push 77
밀리다 to be delayed 77
부품 part 77
빼다 to remove 77
상 up 77
스위치 switch 77
아무리 no matter how 77
우 right 77
우선 first of all 77
이물질 foreign substance 77
작동(하다) operation, to operate 77
장착(하다) installation, to install 77
전원 power 77
점검(하다) inspection, to inspect 77
제대로 properly 77
좌 left 77
켜다 to turn on 77
ㅎ 하 down 77
해체(하다) dismantling, to disassemble 77
핸들 handle 77
환풍기 ventilator 77
회전 rotation 77
갈다 to grind 80
공작물 workpiece 80
구멍 hole 80
구부리다 to bend 80
기구 tool 80
낫다 to be better 80
도려내다 to carve 80
도면 blueprint 80
드릴링머신 drilling machine 80
(먼지를) 떨다 to dust off 80
뚫다 to drill 80
밀링 머신 milling machine 80
선반 기계 lathe machine 80
압축(하다) compression, to compress 80
양 quantity 80
에어컴프레서 air compressor 80
용도 use 80
자르다 to cut 80
전동커터기 electric cutter 80
정확하다 to be accurate 80
찍어 내다 to stamp 80
철판 metal plate 80
칩 chip 80
프레스 기계 press machine 80
고정(하다) fixation, to make something fixed 87
공구 tool 87
나사못 screw 87
너트 nut 87
느슨하다 to be loose 87
니퍼 nippers 87
단단하다 to be solid 87
롱 노즈 플라이어 long-nosed pliers 87
멍키 스패너 adjustable wrench 87
볼트 bolt 87
분해(하다) disassembly, to disassemble 87
스패너 wrench 87
육각 렌치 hex key 87
조립(하다) assembly, to assemble 87
조이다 to tighten 87
조절(하다) control, to control 87
철사 wire 87
토크 렌치 torque wrench 87
파손되다 to be damaged 87
파이프 렌치 pipe wrench 87
펜치 pincers 87
풀다 to loosen 87
플라이어 pliers 87
확인(하다) confirmation, to confirm 87
힘 strength 87
가져오다 to bring 90
경사 slope 90
교체(하다) substitution, to substitute 90
기어 gear 90
돌아가다 to rotate 90
마모되다 to be worn down 90
베어링 bearings 90
ㅅ 사각형 quadrilateral 90
생기다 to be formed 90
수준기 level instrument 90
십자드라이버 phillips screwdriver 90
없어지다 to disappear 90
원형 circle 90
육각형 hexagon 90
일자 드라이버 flat-head screwdriver 90
자석 magnet 90
축 shaft 90
코일 스프링 coil spring 90
평평하다 to be flat 90
풀러 puller 90
해결(하다) solution, to solve 90
금 line 97
금 긋기 바늘 scriber 97
금속 metal 97
긋다 to draw 97
깎다 to shave, cut 97
다듬다 to smooth, refine 97
돌 stone 97
리머 reamer 97
망치 hammer 97
못 nail 97
물체 object 97
바이스 vise 97
박다 to hammer 97
사용법 usage 97
쇠톱 hacksaw 97
전기 드릴 electric drill 97
정 chisel 97
종류 types 97
줄 file 97
쪼다 to chisel 97
파이프 pipe 97
가늘다 to be thin (in diameter) 100
가스 용접기 gas welder 100
굵다 to be thick (in diameter) 100
느리다 to be slow 100
두껍다 to be thick 100
두께 thickness 100
밀리미터 millimeter (mm) 100
불꽃 flame 100
빠르다 to be fast 100
가스가 새다 to leak gas 100
세다 to be strong 100
소화기 fire extinguisher 100
속도 speed 100
약하다 to be weak 100
얇다 to be thin 100
용접(하다) welding, to weld 100
용접봉 welding rod 100
전기 용접기 electric welder 100
전기 절단기 chop saw 100
절단(하다) cutting, to cut 100
절단기 cutter 100
조절기 regulator 100
준비(하다) preparation, to prepare 100
토치 torch 100
튀다 to have sparks 100
판금 가위 sheet metal shears 100
가로 width 107
길이 length 107
무게 weight 107
무게를 재다 to weigh 107
버니어 캘리퍼스 vernier calipers 107
비율 ratio 107
세로 vertical length 107
원재료 raw material 107
ㅈ 자 ruler 107
전자 저울 electronic scale 107
접시 저울 pan scale 107
줄자 tape measure 107
첨가제 additive 107
측정(하다) measuring, to measure 107
투입(하다) inserting, to insert 107
혼합(하다) mixing, to mix 107
혼합기 mixer 107
검다 to be black 110
검사(하다) inspection, to inspect 110
나오다 to come out 110
낮추다 to lower 110
높이다 to raise (something) 110
덜 less 110
불량 defect 110
불량품 defective product 110
살펴보다 to take a look 110
성형 molding 110
압력 pressure 110
원인 cause 110
이상 issue 110
점 spot 110
제품 product 110
조치 action 110
조치를 취하다 to take action 110
줄 line 110
중지(하다) stop, to stop 110
표면 surface 110
휘다 to bend, to be bent 110
관리 대장 control log 117
민감하다 to be sensitive 117
벌레 bug 117
변색되다 to discolor 117
습도 humidity 117
습하다 to be humid 117
약해지다 to weaken 117
오염되다 to be contaminated 117
온습도계 hygrothermograph 117
원사 yarn 117
일정하다 to be consistent 117
장마철 rainy season 117
적정 appropriate 117
주기적 periodic 117
직사광선 direct sunlight 117
통풍이 잘되다 to be well-ventilated 117
피하다 to avoid 117
ㄱ 가공(하다) processing, to process 120
건조(하다) being dry, to dry 120
견 silk 120
고르다 to be smooth 120
나일론 nylon 120
막대기 stick 120
말리다 to dry 120
면 cotton 120
모 wool 120
불순물 impurities 120
서두르다 to hurry 120
섞다 to mix 120
세척(하다) washing, to wash 120
아크릴 acrylic 120
약품 chemicals 120
엉키다 to tangle 120
염료 dyes 120
염색(하다) dyeing, to dye 120
원단 fabric 120
젓다 to stir 120
제거(하다) removal, to remove 120
천연 섬유 natural fiber 120
탈수(하다) water removal, to remove water 120
펴다 to spread 120
폴리에스터 polyester 120
표백(하다) bleaching, to bleach 120
하얗다 to be white 120
합성 섬유 synthetic fibers 120
건 gun 127
그라인더 grinder 127
끌 chisel 127
날물 saw blade 127
대패 plane 127
메모(하다) memo, to take notes 127
목재 hardwood 127
센티미터 centimeters 127
원목 hardwood 127
인치 inch 127
제작(하다) making, to make 127
짜리 worth (money, time, etc.) 127
클램프 clamp 127
테이블톱 table saw 127
폭 width 127
곡류 grains 130
도색(하다) painting, to paint 130
도장(하다) painting, to paint 130
롤러 roller 130
ㅁ 마감재 finish (coating) 130
메우다 to fill up 130
바니시 varnish 130
바르다 to apply 130
분무기 sprayer 130
붓 brush 130
뿌리다 to sprinkle 130
사포 sandpaper 130
사포질(하다) sanding, to sand 130
샌딩(하다) sanding, to sand 130
스프레이 spray 130
열풍기 hot air fan 130
젯소 gesso 130
초벌재 base coat 130
칠(하다) coat, to apply 130
퍼티 putty 130
퍼티헤라 puttyhera 130
페인트 paint 130
홈 groove 130
가져가다 to to take 137
결속 핸들 rebar tying handle 137
결속(하다) binding together, to bind/tie 137
결속선 binding wire 137
교차점 intersection 137
꽉 tightly 137
ㄷ 다녀오다 to go and come back 137
모래 sand 137
배근(하다) rebar arrangement, to arrange rebar 137
복잡하다 to be messy/complicated 137
부탁(하다) request, to request 137
손전등 flashlight 137
시멘트 cement 137
완료(하다) completion, to complete 137
움직이다 to move 137
자갈 gravel 137
철근 rebar 137
충분히 sufficiently 137
콘크리트 concrete 137
콘크리트 믹서 트럭 concrete mixer truck 137
타설(하다) concrete pouring, to pour concrete 137
필요하다 to be necessary 137
거푸집 formwork 140
공사장 construction site 140
기둥 column 140
마주 face to face 140
사라지다 to disappear 140
설치(하다) assembly, to assemble 140
양 bi- 140
웨지핀 wedge pin 140
짓다 to build 140
철거(하다) demolishment, to remove 140
체결(하다) binding/fastening, to bind/fasten 140
플랫 타이 flat tie 140
하중을 받다 to get under pressure 140
고압 high pressure 147
구역 district 147
굳다 to harden 147
그동안 in the meantime 147
긁어내다 to scrape off 147
ㄴ 나누다 to divide, separate 147
딱딱하다 to be hard 147
미루다 to postpone 147
부드럽다 to be soft 147
빨아들이다 to suck up 147
(물을) 빼다 to drain 147
수로 waterway 147
쌓이다 to pile up 147
어서 quickly 147
주문량 order quantity 147
준설(하다) dredging, to dredge 147
처리(하다) handling, to handle 147
침전물 silt 147
토사 sediment 147
퍼내다 to excavate 147
펌프 pump 147
하천 stream 147
호스 hose 147
흐르다 to flow 147
흙 soil 147
흡입(하다) suction, to suck up 147
가까이 nearby 150
관 pipe 150
균열 crack 150
너비 width 150
누수 leak 150
다지다 to compact 150
되메우기 backfilling 150
땅 ground 150
배치(하다) placement, to place 150
상하수도 water supply 150
성토(하다) piling up soil, to pile the soil 150
시공 construction 150
연결(하다) connection, to connect 150
절토(하다) cutting of earth, to cut the soil 150
제자리 in place 150
주위 surroundings 150
진행되다 to have progressed 150
채우다 to fill up 150
터파기 excavation 150
ㅍ 파다 to excavate 150
핸드 램머 hand rammer 150
감자 potato 157
거름 fertilizer 157
경운기 rotary tiller 157
고구마 sweet potato 157
고라니 water deer 157
고추 pepper 157
곡괭이 pickaxe 157
나뭇가지 tree branch 157
낫 sickle 157
넘어지다 to fall over 157
논 paddy 157
농작물 crop 157
따 먹다 to pick and eat 157
따다 to pick 157
모내기(하다) rice transplantation, to plant rice seedlings 157
모종 seedling 157
모판 seedbed 157
무 radish 157
물을 대다 to water 157
밭 field 157
배추 cabbage 157
베다 to cut 157
벼 rice stalks 157
비닐하우스 greenhouse 157
비료 fertilizer 157
뽑다 to pull out 157
삽 shovel 157
심다 to plant 157
씨앗을 뿌리다 to sow seeds 157
오이 cucumber 157
울타리망 net fence 157
잎사귀 leaf 157
전작 field crops 157
지주대 support post 157
ㅋ 캐다 to dig 157
케이블타이 cable tie 157
트랙터 tractor 157
파이다 to be dug 157
파종 상자/ 육모 상자 sowing tray/seedling tray 157
호미 hoe 157
호박 pumpkin 157
감 persimmon 160
과수 재배 orchard cultivation 160
과수원 orchard 160
귤 tangerine 160
농약 pesticides 160
모으다 to gather 160
배 pear 160
변하다 to change 160
복숭아 peach 160
봉지 bag 160
블루베리 blueberry 160
살짝 lightly 160
손자국이 남다 to have handprints 160
수확(하다) harvest, to harvest 160
씌우다 to cover 160
예초기 weed cutter 160
익다 to ripen 160
잡초 weeds 160
장갑 gloves 160
참외 oriental melon 160
포도 grape 160
계량컵 measuring cup 167
급수기 waterer 167
급여(하다) feeding, to feed 167
급이기 feeder 167
나중에 later 167
농장 farm 167
닭 chicken 167
돼지 pig 167
말 horse 167
먹이 food 167
ㅂ 바가지 bowl with handle 167
배합 사료 compound feed 167
사료 feed 167
사료조 feed bin 167
소 cow 167
양 sheep 167
양계 poultry farming 167
양돈 pig farming 167
양우 cattle farming 167
오리 duck 167
짚 straw 167
키우다 to raise 167
토끼 rabbit 167
건초 hay 170
물청소(하다) water cleaning, to wash with water 170
분뇨 manure 170
분뇨 탱크 manure tank 170
양계장 poultry house 170
우방 stall 170
이동시키다 to move 170
축사 barn 170
톱밥 sawdust 170
갑판 deck 177
고압 분사기 pressure washer 177
그물 fishing net 177
끌어 올리다 to pull up 177
낚시(하다) fishing, to fish 177
닻 anchor 177
뜰채 hand net 177
물고기 fish 177
바구니 basket 177
바늘 hook 177
바늘대 netting needle 177
부표 buoy 177
수선(하다) mending, to mend 177
양망기 net hauler 177
어업 fishery 177
찢어지다 to be torn 177
ㅊ 차광막 shade cloth 177
통발 fish trap 177
흔들리다 to be shaken 177
꼬이다 to get tangled 180
농도 concentration 180
대비(하다) preparation, to prepare 180
보고(하다) report, to report 180
산소 oxygen 180
산소 공급기 oxygen supply system 180
선별(하다) sorting, to sort 180
수조 tank 180
수질 water quality 180
양식업 aquaculture 180
양식장 aquaculture farm 180
어류 fish 180
예비용 spare 180
온도계 thermometer 180
유통기한 expiration date 180
접히다 to be folded 180
추가(하다) addition, to add 180
골고루 evenly 187
금이 가다 to get cracked 187
녹 rust 187
도료 paint 187
마무리(하다) finish, to finish 187
매끄럽다 to be smooth 187
면적 area 187
물기 moisture 187
부식 corrosion 187
분사(하다) spray, to spray 187
선미부 stern section 187
선박 ship 187
선수부 bow section 187
선원실 crew’s quarters 187
선체 hull 187
에어 스프레이 건 air spray gun 187
에어리스 스프레이 건 airless spray gun 187
에어리스 스프레이 펌프 airless spray pump 187
조타실 wheelhouse 187
중앙부 midsection 187
프로펠러 propeller 187
가새 brace 190
강관 비계 steel pipe scaffold 190
고장 malfunction 190
구조물 temporary structure 190
깔판 floorboard 190
능률 efficiency 190
대각선 diagonal 190
띠장 wale 190
밑둥잡이 base stabilizer 190
밑받침 철물 base metal fitting 190
비계기둥 scaffold pole 190
세우다 to set up 190
수직 vertical 190
수평 horizontal 190
실수(하다) mistake, to make a mistake 190
안전 로프 safety rope 190
안전난간 safety railing 190
안정성 stability 190
임시로 temporarily 190
작업발판 work platform 190
장선 joist 190
정기적 regular 190
지지대 support 190
품질 quality 190
갱구 tunnel entrance 197
갱도 tunnel 197
광부 miner 197
광차 mine cart 197
권양기 winch 197
막장 mine 197
사갱 shaft 197
선탄장 coal washery 197
수갱 drainage shaft 197
수평갱 horizontal shaft 197
시설 facilities 197
인차 mantrip 197
일손 worker 197
채광장 mining site 197
탄광 coal mining 197
티플링실 tippling room 197
간격 space, interval 200
골라내다 to pick out 200
광석 ore 200
깔다 to lay 200
깨다 to break 200
덩어리 lump 200
레일 rails 200
바위 rock 200
발파(하다) blasting, to blast 200
버력 impurities 200
부수다 to break 200
석탄 coal 200
스크레이퍼 scraper 200
지주 support 200
착암기 rock drill 200
채광 mining 200
채탄 coal mining 200
컨베이어 conveyor belt 200
퍼 올리다 to scoop up 200
폭약 explosive 200
폭파(하다) explosion, to blast 200
함마 sledgehammer 200
가지 branch 207
감다 to wrap 207
거리 distance 207
굴착기 excavator 207
굴취 trenching 207
나무 tree 207
둥글다 to be round 207
마대 burlap bag 207
밑동 base 207
밴드 band 207
부러뜨리다 to break 207
분 root ball 207
분 감기 root ball wrapping 207
뿌리 root 207
뿌리 가위 root shears 207
소형 small 207
순서 order 207
쏟다 to spill 207
아랫부분 lower part 207
잎 leaf 207
잔뿌리 fine roots 207
줄기 trunk 207
지름 diameter 207
톱 saw 207
표시(하다) marking, to mark 207
풀리다 to loosen 207
말뚝 stake 210
벌목 felling, logging 210
벌채지 logging site 210
운재 log transporting 210
조재 bucking 210
집재 log gathering 210
집재장 log yard 210
챙기다 to pack 210
체인톱 chainsaw 210
치다 to trim 210
토막을 내다 to cut into pieces 210
톱질(하다) sawing, to saw 210
하베스터 harvester 210
객실 guest room 217
꽂다 to put 217
대걸레 mop 217
대다 to tap 217
떼다 to remove 217
린넨실 linen room 217
린스 (hair) conditioner 217
마른걸레 dry cloth 217
마스터키 master key 217
목욕가운 bathrobe 217
바디워시 body wash 217
방향제 air freshener 217
비누 soap 217
비품실 supply room 217
생수 bottled water 217
샴푸 shampoo 217
소모품 consumable 217
수건 towel 217
시트 bed sheet 217
어메니티 amenities 217
전동식 motor operated 217
전화선 phone cord 217
청소도구함 cleaning tool box 217
치약 toothpaste 217
칫솔 toothbrush 217
커튼을 치다 to draw the curtains 217
플러그 plug 217
하우스키핑 카트 housekeeping cart 217
DND 카드 do not disturb card 220
가져다 놓다 to place/put down 220
객실 용품 room amenities 220
리모컨 remote control 220
메이드 보고서 maid report 220
메이크업 카드 makeup card 220
미니바 mini bar 220
스낵 snacks 220
얼룩 stain 220
옷걸이 hanger 220
이불보 duvet cover 220
전등 light 220
줍다 to pick up 220
침대보 bed sheet 220
헤어드라이어 hair dryer 220
화장대 dressing table 220
녹다 to melt 227
대용량 bulk 227
망 net 227
밀폐용기 airtight container 227
비닐랩 plastic wrap 227
소분(하다) small pack, to divide up 227
소비 기한 expiration date 227
소스 sauce 227
시들다 to wilt 227
식자재 food ingredients 227
식재료 ingredients 227
신문지 newspaper 227
싹이 나다 to sprout 227
썩다 to rot 227
위생백 sanitary bag 227
주문서 order form 227
주방용품 kitchen supplies 227
지퍼백 zipper bag 227
쿠킹호일 aluminum foil 227
키친타월 paper towel 227
통조림 canning 227
강판 grater 230
개월 months 230
곰팡이가 피다 to grow mold 230
국자 ladle 230
깎기(필러) peeler 230
녹이다 to melt (something) 230
도마 cutting board 230
뒤집개 spatula 230
번식(하다) reproduction, to reproduce 230
부패(하다) rot, to rot 230
세균 bacteria 230
손질하다 to trim 230
식중독 food poisoning 230
식칼 knife 230
실온 room temperature 230
쌀 rice 230
안전 관리 safety management 230
유제품 dairy products 230
육류 meats 230
조개 clam 230
주걱 rice scoop 230
주방 집기 kitchen utensils 230
치즈 cheese 230
피다 to grow (mold) 230
핏물이 생기다 to bleed 230
해동(하다) defrosting, to defrost 230
해산물 seafood 230
경고(하다) warning, to warn 237
독성 toxic 237
물질 material 237
미끄럽다 to be slippery 237
바닥면 floor 237
바이러스 virus 237
방사능 radioactivty 237
방사선 radiation 237
산업용 운반기계 industrial vehicles 237
생물 (living) organism 237
생물학적 biological 237
알리다 to notify 237
위해 hazard 237
유출(되다) leak, to be leaked out 237
이온화 ionizing 237
인화 flammable 237
일반 general 237
장애물 obstacle 237
전기 electricity 237
추락(하다) fall, to fall 237
표지 sign 237
그냥 just 238
낙하물 falling objects 238
데다 to get burned 238
불이 붙다 to catch fire 238
위험(하다) risk, to be dangerous 238
취급(하다) handling, to handle 238
금지(하다) prohibition, to prohibit 240
발연 smoke 240
발화원 ignition sources 240
불 fire 240
불을 붙이다 to light a fire 240
산업용 차량 industrial vehicle 240
삽입(하다) insertion, to insert 240
승강기 lift 240
승객용 for people 240
야외용 outdoor 240
접근(하다) access, to access 240
착용(하다) wear, to wear 240
착화 ignition 240
통행(하다) passage, to pass 240
화재 fire 240
휴대용 그라인더 hand-held grinding machine 240
기대다 to lean 241
지나가다 to pass 241
통로 passage 241
개인 each person 247
귀마개 earplugs 247
대피(하다) evacuation, to evacuate 247
밀폐공간 confined spaces 247
보건 health 247
보호구 protective equipment 247
석면 asbestos 247
섭취(하다) intake, to eat 247
수칙 regulations 247
음식물 food 247
장치 system 247
중단(하다) stop, to stop 247
화학물질 chemical substances 247
개구부 opening, entrance 250
끼이다 to be trapped 250
낙하(하다) falling, to fall 250
난간 rail 250
막다 to prevent 250
반드시 absolutely 250
방호덮개 protective covers 250
방호장치 safety device 250
사항 terms 250
산업 industry 250
수리(하다) repair, to repair 250
실시(하다) implementation, to implement 250
안전대 safety harness 250
안전모 safety helmet 250
안전보건교육 safety and health prevention education 250
안전보건표지판 safety sign 250
안전화 safety shoes 250
잠금장치 locking device 250
재해 accident 250
조작(하다) operation, to operate 250
준수(하다) compliance, to follow 250
줄이다 to reduce 250
차단(하다) cut-off, to block 250
공통 commonness 257
귀덮개 earmuffs 257
방독 마스크 gas mask 257
방제복 protection suit 257
방진 마스크 dust mask 257
보안경 safety goggles 257
송기 마스크 air supply mask 257
안면 보호구 face protection equipment 257
안전 safety 257
안전장갑 safety gloves 257
용접면 welding face shield 257
장비 equipment 257
축산 livestock 257
특화 specialized 257
LED 램프 led lamp 260
구명조끼 life jacket 260
무릎보호대 knee pad 260
방수 앞치마 waterproof apron 260
방열두건 heat-resistant hood 260
방열상의 heat-resistant jacket 260
방열장갑 heat-resistant gloves 260
방열장화 heat-resistant boots 260
방열하의 heat-resistant pants 260
열처리 작업 heat treatment 260
오븐 장갑 oven mitts 260
위생 sanitary 260
위생마스크 sanitary mask 260
위생모 sanitary hat 260
위생복 sanitary clothing 260
위생장갑 sanitary gloves 260
위생장화 sanitary boots 260
절단방지 장갑 cut-resistant gloves 260
절연 안전모 insulating helmet 260
절연 장갑 insulating boots 260
절연 장화 insulating gloves 260
평소 usual 260
화상을 입다 to get burned 260
감전 electric shock 267
대응(하다) response, to respond 267
무너지다 to collapse 267
방화문 fire door 267
밸브 valve 267
베이다 to get cut 267
보호(하다) protection, to protect 267
비상 전화 emergency telephone 267
삐다 to sprain 267
산화성 oxidizing 267
상황별 by situation 267
소방 장비 fire safety equipment 267
소화전 fire hydrant 267
요령 guidelines 267
유해 hazardous 267
인화성 flammable 267
점화원 ignition source 267
진행(하다) progress, to proceed 267
진화(하다) extinguishment, to extinguish 267
질식 suffocation 267
초기 initial 267
피부 skin 267
호스릴 hose station 267
호흡기 respiratory system 267
화기 open flame 267
화재 경보기 fire alarm 267
경찰서 police station 270
관리감독자 management supervisor 270
긴급 emergency 270
도움 help 270
보존(하다) preservation, to preserve 270
사건 accident 270
상급자 superior 270
설명(하다) explanation, to explain 270
소방서 fire department (119) 270
외치다 to shout 270
요청(하다) request, to request 270
응급 emergency 270
응급조치 first aid 270
처치(하다) treatment/handling, to treat/handle 270
통화(하다) phone call, to phone 270
현장 site 270
화재가 나다 fire 270
가산점 extra point 277
건설업 construction 277
고용허가제 employment permit system 277
광업 mining 277
농업 agriculture 277
서비스업 service 277
업종 industry type 277
음식서비스업 food service 277
임업 forestry 277
제조업 manufacturing 277
조선업 shipbuilding 277
축산업 livestock 277
콘도업 hotel and condo business 277
1차 first 280
2차 second 280
계약(하다) contract, to contract 280
공지 notice 280
구직자 job seeker 280
근로 labor 280
기능 시험 skills test 280
기초 foundation 280
면접 interview 280
명부 list 280
배치되다 to be assigned 280
법령 laws 280
비자 visa 280
사업장 workplace 280
사전 in advance, prior 280
송부 forwarding 280
신입 사원 new employee 280
입국 arrival 280
작성(하다) request, to request 280
절차 procedure 280
체결 binding 280
체력 physical ability 280
취업 employment 280
평가 evaluation 280
표준근로계약 standard labor contract 280
한국어능력시험 (고용허가제) Employment Permit System - Test of Proficiency in Korean (EPS-TOPIK) 280
훨씬 much (more) 280
궁금하다 to be curious 287
기본 basic 287
내용 content 287
들어오다 to come in 287
부담(하다) responsibility-bearing, to bear a responsibility 287
수당 extra pay, allowance 287
수습 probationary 287
숙식 room and board 287
야간 night-time 287
월급 monthly salary 287
임금 payment 287
제공(하다) provision, to provide 287
조건 condition 287
지급(하다) payment, to pay 287
지급일 payday 287
휴게 recess 287
휴일 holiday 287
건강보험 health insurance 290
고용보험 employment insurance 290
공제(하다) deduction, to deduct 290
공제액 deduction amount 290
국민연금 national pension 290
금액 amount 290
급여 pay 290
기본급 base pay 290
내역 details 290
(닳아서) 떨어지다 to run out (of) 290
명세서 stub 290
보험 insurance 290
상여금 bonus 290
세금 tax 290
소득세 income tax 290
식대 meal expense 290
실수령액 net pay 290
실제로 in reality 290
연말정산 year-end tax 290
연장 근로 overtime 290
주민세 resident tax 290
지급액 payment amount 290
합계 total 290
환급(하다) refund, to refund 290
거주/숙소제공 확인서 confirmation of residency/accommodation 297
고용주 employer 297
고치다 to revise 297
등록(하다) registration, to register 297
마약 drug 297
마약 검사 확인서 drug test confirmation form 297
목록 list 297
반복(하다) repetition, to repeat 297
발급받다 to be issued 297
법무부 the Ministry of Justice 297
비회원 non-member 297
사본 copy 297
사업자등록증 business license 297
수령(하다) receival, to receive 297
수수료 processing fees 297
외국인 foreigner 297
외국인등록증 residence card 297
이내 within 297
임대차 계약서 lease agreement 297
자격 status 297
정확히 accurately 297
제출(하다) submission, to submit 297
지정(하다) designation, to designate 297
체류지 입증 서류 proof of residency 297
체류허가 신청확인서 "permission of stay application confirmation" 297
출입국 · 외국인 사무소 immigration office 297
통합신청서 (integrated) application form 297
가능 possibility 300
구직등록필증 job seeker registration certificate 300
귀국(하다) homecoming, to return to one's home country 300
만료되다 to expire 300
만료일 expiration date 300
물어보다 to ask 300
변경(하다) change, to change 300
불만 discontentment 300
소식 news 300
여유 spare time 300
연락 contact 300
연장(하다) extention, to extend 300
이직(하다) changing jobs, to change jobs 300
자진 출국 각서 voluntary departure form 300
지방 고용노동관서 regional employment and labor office 300
차다 to be full 300
체류(하다) stay, to stay/sojourn 300
허가 permission 300
횟수 number of times 300
4대 보험 four major social insurances 307
가입(하다) sign up, to sign up 307
납입(하다) payment, to pay 307
누구나 anyone 307
병원비 medidcal bills 307
보험금 insurance benefits 307
보험료 insurance premiums 307
사업주 employer 307
산재보험 industrial accident compensation insurance 307
의료비 medical expenses 307
입원(하다) to be hospitalized 307
입증(하다) proof, to proof 307
장해 보상금 disability compensation 307
청구(하다) claim, to claim 307
체하다 to feel indigestion 307
ㅌ 타다 to collect 307
혜택 benefit 307
휴업 급여 temporary layoff benefits 307
귀국비용보험 return cost insurance 310
벌금 fine 310
보험 약정 insurance contract 310
부담없다 to be burden-free 310
사고 입증 서류 proof of accident document 310
사망 death 310
상해 injury 310
상해보험 personal injury insurance 310
외국인 근로자 전용 보험 insurance exclusive to foreign workers 310
일시금 lump sum 310
임금체불보증보험 pay guarantee insurance 310
장애 disability 310
진단서 medical certificate 310
질병 illness 310
체불 임금 unpaid wages 310
출국만기보험 departure guarantee insurance 310
출국예정사실 확인서 certificate of expected departure 310
퇴직금 severance pay 310
`;

/* ========= Parser ========= */
function parseLines(raw){
  const lines = raw.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const out = [];
  for(const line of lines){
    const m = line.match(/^(.*)\s(\d+)$/);
    if(!m) continue;
    const page = +m[2];
    let rest = m[1].trim();
    // drop leading stray jamo like "ㅈ " or "ㄹ "
    rest = rest.replace(/^[\u3131-\u314e]\s+/, '');
    // find last Hangul, include closing ) or ]
    let lastHangul = -1;
    for(let i=0;i<rest.length;i++){ if(/[가-힣]/.test(rest[i])) lastHangul = i; }
    let ko="", en="";
    if(lastHangul>=0){
      let end = lastHangul + 1;
      while(end < rest.length && /[\)\]]/.test(rest[end])) end++;
      ko = rest.slice(0,end).trim();
      en = rest.slice(end).trim();
      if(!en){ const parts = rest.split(/\s+/); ko = parts.shift(); en = parts.join(' ').trim(); }
    }else{
      const parts = rest.split(/\s+/); ko = parts.shift(); en = parts.join(' ').trim();
    }
    out.push({page, ko, en});
  }
  return out;
}

/* ========== POS tagging (adverbs = whitelist only) ========== */
const ADVERB_WHITELIST = new Set([
  '가끔','항상','미리','함부로','훨씬','자꾸','빨리',
  '꼼꼼하다','정확히','주기적','정기적','보통','충분히','특히',
  '먼저','우선','제대로','반드시','임시로','골고루','살짝'
]);

function tagPOS(entry){
  const koRaw = entry.ko.replace(/\s+/g,' ').trim();
  const koNorm = koRaw; // as written
  const enLower = entry.en.toLowerCase();

  if (ADVERB_WHITELIST.has(koNorm)) {
    return {...entry, pos:'adverb', baseKo: koNorm};
  }

  let baseKo = koRaw.includes('(하다)') ? koRaw.replace('(하다)','하다') : koRaw;
  const enStartsTo = /^to\s+[a-z]/.test(enLower);
  const enToBe = /^to\s+be\b/.test(enLower) || /^\b(be|is|are)\b/.test(enLower);

  let pos = 'noun';
  if (enStartsTo || /\(하다\)/.test(koRaw) || /다$/.test(baseKo)) {
    pos = enToBe ? 'adjective' : 'verb';
  } else {
    pos = 'noun';
  }

  if ((pos==='verb' || pos==='adjective') && !/다$/.test(baseKo)) baseKo += '다';
  return {...entry, pos, baseKo};
}


/* ========= Hangul utils ========= */
const SBASE=0xAC00, VCOUNT=21, TCOUNT=28, NCOUNT=VCOUNT*TCOUNT;
const T=['','ᆨ','ᆩ','ᆪ','ᆫ','ᆬ','ᆭ','ᆮ','ᆯ','ᆰ','ᆱ','ᆲ','ᆳ','ᆴ','ᆵ','ᆶ','ᆷ','ᆸ','ᆹ','ᆺ','ᆻ','ᆼ','ᆽ','ᆾ','ᆿ','ᇀ','ᇁ','ᇂ'];
const T_SSIOT=20, T_L=8, T_B=17;
const V=['ᅡ','ᅢ','ᅣ','ᅤ','ᅥ','ᅦ','ᅧ','ᅨ','ᅩ','ᅪ','ᅫ','ᅬ','ᅭ','ᅮ','ᅯ','ᅰ','ᅱ','ᅲ','ᅳ','ᅴ','ᅵ'];
const V_A=0, V_EO=4, V_O=8, V_WA=9, V_U=13, V_WO=14, V_I=20, V_E=5, V_YEO=6, V_YU=17, V_EU=18;

function isHangulSyll(ch){const c=ch.charCodeAt(0); return c>=0xAC00 && c<=0xD7A3;}
function decompose(ch){const n=ch.charCodeAt(0)-SBASE; const li=Math.floor(n/NCOUNT); const vi=Math.floor((n%NCOUNT)/TCOUNT); const ti=n%TCOUNT; return {li,vi,ti};}
function compose(li,vi,ti){return String.fromCharCode(SBASE + (li*NCOUNT) + (vi*TCOUNT) + ti);}
function lastSyllable(str){ for(let i=str.length-1;i>=0;i--){ if(isHangulSyll(str[i])) return {ch:str[i], idx:i}; } return null; }
function replaceLastSyllable(str, fn){ const last=lastSyllable(str); if(!last) return str; const d=decompose(last.ch); const r=fn({...d}); const ch2=compose(r.li,r.vi,r.ti); return str.slice(0,last.idx)+ch2+str.slice(last.idx+1); }
function setFinal(str, ti){ return replaceLastSyllable(str, s=>({li:s.li,vi:s.vi,ti})); }
function setVowel(str, vi){ return replaceLastSyllable(str, s=>({li:s.li,vi,ti:s.ti})); }
function getLastVT(str){ const last=lastSyllable(str); if(!last) return {vi:-1, ti:-1}; const d=decompose(last.ch); return {vi:d.vi, ti:d.ti}; }
function getPrevVowelIndex(stem){
  let skipped=false;
  for(let i=stem.length-1;i>=0;i--){
    const ch=stem[i]; if(!isHangulSyll(ch)) continue;
    if(!skipped){ skipped=true; continue; }
    return decompose(ch).vi;
  }
  return V_A;
}

/* ========= Conjugation ========= */
const BIEUP_SET=new Set(['돕다','곱다']);
const D_IRR_SET=new Set(['걷다','듣다','묻다']);
const S_IRR_SET=new Set(['짓다','낫다','젓다','붓다']);

function fuseEO(stem){
  const {vi,ti}=getLastVT(stem);
  if(ti>0) return stem+'어';
  if(vi===V_U) return setVowel(stem,V_WO);
  if(vi===V_I) return setVowel(stem,V_YEO);
  if(vi===V_EO || vi===V_YEO || vi===V_E) return stem;
  return stem+'어';
}
function presentBaseStrict(da,pos){
  if(/하다$/.test(da)) return da.replace(/하다$/,'해');
  let stem = da.replace(/다$/,'');
  const vt = getLastVT(stem);

  if(vt.ti===T_B){
    if(pos==='adjective') return setFinal(stem,0)+'워';       // 덥다 → 더워
    if(BIEUP_SET.has(da)){ const base=setFinal(stem,0); return (getLastVT(base).vi===V_O? setVowel(base,V_WA): base+'아'); }
    return (vt.vi===V_A || vt.vi===V_O) ? (stem+'아') : (stem+'어'); // 잡다/입다
  }
  if(D_IRR_SET.has(da)){ stem=setFinal(stem,T_L); return stem+'어'; }
  if(S_IRR_SET.has(da)){ stem=setFinal(stem,0); return fuseEO(stem); }
  if(/르다$/.test(da)){
    const prevPart = stem.slice(0,-1);
    const prev = lastSyllable(prevPart);
    const prevVi = prev ? decompose(prev.ch).vi : V_EO;
    const prevFixed = replaceLastSyllable(prevPart, s=>({li:s.li,vi:s.vi,ti:T_L}));
    const useA = (prevVi===V_A || prevVi===V_O);
    return prevFixed + (useA?'라':'러');
  }
  if(vt.vi===V_EU){
    const useA=(getPrevVowelIndex(stem)===V_A || getPrevVowelIndex(stem)===V_O);
    return setVowel(stem, useA?V_A:V_EO);
  }
  if(vt.ti>0) return (vt.vi===V_A || vt.vi===V_O) ? (stem+'아') : (stem+'어');
  if(vt.vi===V_A) return stem;                 // 가다→가
  if(vt.vi===V_O) return setVowel(stem,V_WA);  // 오다→와
  if(vt.vi===V_U) return setVowel(stem,V_WO);  // 배우다→배워
  if(vt.vi===V_I) return setVowel(stem,V_YEO); // 마시다→마셔
  if(vt.vi===V_EO || vt.vi===V_YEO || vt.vi===V_E) return stem;
  return stem+'어';
}
const presentPolite=(da,pos)=>presentBaseStrict(da,pos)+'요';
function addSsiotToLast(str){
  const last=lastSyllable(str); if(!last) return str+'었';
  const d=decompose(last.ch);
  if(d.ti===0){ const withSs=compose(d.li,d.vi,T_SSIOT); return str.slice(0,last.idx)+withSs+str.slice(last.idx+1); }
  return str+'었';
}
function pastPolite(da,pos){ if(/하다$/.test(da)) return da.replace(/하다$/,'했어요'); return addSsiotToLast(presentBaseStrict(da,pos))+'어요'; }
function futurePolite(da,pos){
  if(/하다$/.test(da)) return da.replace(/하다$/,'할 거예요');
  const stem=da.replace(/다$/,''); const last=lastSyllable(stem); const d=last?decompose(last.ch):null;
  if(d && d.ti===T_B){
    if(pos==='adjective' || BIEUP_SET.has(da)) return setFinal(stem,0)+'울 거예요'; // 더울/도울
    return stem+'을 거예요'; // 잡을
  }
  if(D_IRR_SET.has(da)) return setFinal(stem,T_L)+'을 거예요';
  if(S_IRR_SET.has(da)) return setFinal(stem,0)+'을 거예요';
  if(/르다$/.test(da))  return setFinal(stem,T_L)+' 거예요';
  if(d && d.ti===T_L) return stem+' 거예요';
  return (d && d.ti===0) ? (setFinal(stem,T_L)+' 거예요') : (stem+'을 거예요');
}

/* ========= English gloss per tense ========= */
function normalizeVerbAdjEnglish(enRaw){
  const en=enRaw.trim();
  const toMatches=[...en.matchAll(/(?:^|[,/;])\s*to\s+([a-z].*?)\s*$/ig)];
  if(toMatches.length){
    const base=toMatches[toMatches.length-1][1].trim();
    if(/^be\b/i.test(base)) return {type:'be', base:base.replace(/^be\b\s*/i,'').trim()};
    return {type:'verb', base};
  }
  if(/^to\s+be\s+/i.test(en)) return {type:'be', base:en.replace(/^to\s+be\s+/i,'').trim()};
  if(/^to\s+/i.test(en)) return {type:'verb', base:en.replace(/^to\s+/i,'').trim()};
  return {type:'other', base:en};
}
const IRREG_PAST={go:'went',come:'came',do:'did',eat:'ate',drink:'drank',read:'read',buy:'bought',meet:'met',make:'made',give:'gave',take:'took',write:'wrote',run:'ran',see:'saw',watch:'watched',sleep:'slept',drive:'drove',speak:'spoke',say:'said',have:'had',put:'put',cut:'cut',teach:'taught',catch:'caught',think:'thought',feel:'felt',leave:'left',find:'found',sing:'sang',sit:'sat',stand:'stood',begin:'began',become:'became',hear:'heard',hold:'held',keep:'kept',pay:'paid'};
function toIng(w){const lw=w.toLowerCase(); if(lw==='be') return 'being'; if(/ie$/i.test(w)) return w.slice(0,-2)+'ying'; if(/e$/i.test(w)&&!/(ee|ye|oe)$/i.test(w)) return w.slice(0,-1)+'ing'; if(/[^aeiou][aeiou][^aeiouwxy]$/i.test(w)&&w.length<=5) return w+w.slice(-1)+'ing'; return w+'ing';}
function pastOf(w){const lw=w.trim().toLowerCase(); if(IRREG_PAST[lw]) return IRREG_PAST[lw]; if(/e$/.test(lw)) return lw+'d'; if(/[^aeiou]y$/.test(lw)) return lw.slice(0,-1)+'ied'; return lw+'ed';}
function tenseMeaning(enRaw,pos,tense){
  const info=normalizeVerbAdjEnglish(enRaw);
  if(info.type==='be' || pos==='adjective'){
    const x=info.type==='be'?info.base:enRaw.replace(/^to\s+be\s+/i,'').trim();
    if(tense==='pres') return `is/are ${x}`;
    if(tense==='past') return `was/were ${x}`;
    return `will be ${x}`;
  }
  if(info.type==='verb'){
    const v=info.base;
    if(tense==='pres') return `${v} / are/is ${toIng(v)}`;
    if(tense==='past') return pastOf(v);
    return `will ${v}`;
  }
  return info.base;
}

/* ========= Build & state ========= */
const DATA = parseLines(RAW).map(tagPOS);
const state = { cat:'all', query:'' };
const listEl = document.getElementById('list');
const nohitEl = document.getElementById('nohit');
const q = document.getElementById('q');

/* ========= TTS ========= */
let koVoice=null;
function pickKoreanVoice(){
  const voices=speechSynthesis.getVoices();
  koVoice = voices.find(v => (v.lang||'').toLowerCase().startsWith('ko')) || null;
}
pickKoreanVoice();
window.speechSynthesis.onvoiceschanged = pickKoreanVoice;

/* ========= Filters ========= */
document.getElementById('filters').addEventListener('click', (e)=>{
  const pill=e.target.closest('.pill'); if(!pill) return;
  [...e.currentTarget.children].forEach(n=>n.classList.remove('active'));
  pill.classList.add('active');
  state.cat=pill.dataset.cat;
  applyFilters();
});

/* ========= Search & clear ========= */
q.addEventListener('input', ()=>{ state.query=q.value.trim().toLowerCase(); applyFilters(); });
document.getElementById('clearBtn').addEventListener('click', ()=>{ q.value=''; state.query=''; applyFilters(); });

/* ========= Rendering ========= */
function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
function escapeAttr(s){return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;');}
function escapeReg(s){return String(s).replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
function highlightAny(text,term){
  if(!term) return escapeHtml(text);
  const re=new RegExp('('+escapeReg(term)+')','ig');
  return escapeHtml(text).replace(re,'<mark>$1</mark>');
}
function applyFilters(){
  let items=DATA.slice();
  if(state.cat!=='all') items=items.filter(it=>it.pos===state.cat);
  const term=state.query;
  if(term){
    items = items.filter(it =>
      it.ko.toLowerCase().includes(term) ||
      it.en.toLowerCase().includes(term) ||
      (''+it.page).includes(term)
    );
  }
  items.sort((a,b)=>a.page-b.page);
  renderList(items, term);
}
function renderList(items, term){
  [...listEl.querySelectorAll('.row,.exp')].forEach(n=>n.remove());
  if(!items.length){ nohitEl.style.display='block'; return; }
  nohitEl.style.display='none';

  const frag=document.createDocumentFragment();
  for(const it of items){
    const isVA=(it.pos==='verb'||it.pos==='adjective');
    const row=document.createElement('div');
    row.className='row';
    row.dataset.pos=it.pos;

    const toggle = isVA ? '<span class="toggle" title="Expand/Collapse">▸</span>' : '';
    const koenCell = `
      <div class="koen">
        <div class="ko-line">${toggle}<span>${highlightAny(it.baseKo||it.ko, term)}</span></div>
        <div class="en-line">${highlightAny(it.en, term)}</div>
      </div>
    `;

    row.innerHTML = `
      <div class="num">${(''+it.page)}</div>
      ${koenCell}
      <button class="play" title="Play: ${escapeAttr(it.baseKo||it.ko)}" aria-label="Play ${escapeAttr(it.baseKo||it.ko)}" data-ko="${escapeAttr(it.baseKo||it.ko)}">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z"/></svg>
      </button>
    `;
    frag.appendChild(row);

    if(isVA){
      const da=it.baseKo;
      const pres=presentPolite(da,it.pos);
      const past=pastPolite(da,it.pos);
      const futu=futurePolite(da,it.pos);
	  
  const exp=document.createElement('div');
exp.className='exp';
exp.innerHTML = `
  <div class="chips">
    <!-- Present -->
    <div class="chip">
      <div class="chip-title">Present</div>
      <div class="chip-ko">
        <span class="form">${escapeHtml(pres)}</span>
        <button class="play-mini" title="Play ${escapeAttr(pres)}" data-ko="${escapeAttr(pres)}">
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
      </div>
      <div class="chip-en">${escapeHtml(tenseMeaning(it.en, it.pos, 'pres'))}</div>
    </div>

    <!-- Past -->
    <div class="chip">
      <div class="chip-title">Past</div>
      <div class="chip-ko">
        <span class="form">${escapeHtml(past)}</span>
        <button class="play-mini" title="Play ${escapeAttr(past)}" data-ko="${escapeAttr(past)}">
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
      </div>
      <div class="chip-en">${escapeHtml(tenseMeaning(it.en, it.pos, 'past'))}</div>
    </div>

    <!-- Future -->
    <div class="chip">
      <div class="chip-title">Future</div>
      <div class="chip-ko">
        <span class="form">${escapeHtml(futu)}</span>
        <button class="play-mini" title="Play ${escapeAttr(futu)}" data-ko="${escapeAttr(futu)}">
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
      </div>
      <div class="chip-en">${escapeHtml(tenseMeaning(it.en, it.pos, 'futu'))}</div>
    </div>
  </div>
`;

      frag.appendChild(exp);
    }
  }
  listEl.appendChild(frag);
}

/* ========= Toggles & audio ========= */
listEl.addEventListener('click', (e)=>{
  if (
    e.target.classList.contains('toggle') ||
    (e.target.closest('.ko-line') &&
     e.target.closest('.row')?.dataset.pos !== 'noun' &&
     e.target.closest('.row')?.dataset.pos !== 'adverb')
  ) {
    const row=e.target.closest('.row'); if(!row) return;
    const exp=row.nextElementSibling; if(!exp || !exp.classList.contains('exp')) return;
    const willOpen=!row.classList.contains('open');
    listEl.querySelectorAll('.row.open').forEach(r=>{
      if(r!==row){ r.classList.remove('open'); const tt=r.querySelector('.toggle'); if(tt) tt.textContent='▸'; }
    });
    if(willOpen){ row.classList.add('open'); const t=row.querySelector('.toggle'); if(t) t.textContent='▾'; }
    else { row.classList.remove('open'); const t=row.querySelector('.toggle'); if(t) t.textContent='▸'; }
    return;
  }
  const btn=e.target.closest('.play'); if(btn){ speakKo(btn.getAttribute('data-ko')||''); return; }
  const mbtn=e.target.closest('.play-mini'); if(mbtn){ speakKo(mbtn.getAttribute('data-ko')||''); return; }
});
function speakKo(txt){
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(txt);
    u.lang='ko-KR';
    if(koVoice) u.voice=koVoice;
    u.rate=0.95; u.pitch=1.0;
    speechSynthesis.speak(u);
  }catch(err){ alert('TTS not supported in this browser.'); }
}

/* ========= Initial run ========= */
applyFilters();
</script>
</body>
</html>

